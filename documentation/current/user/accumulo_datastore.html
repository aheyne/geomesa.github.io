

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Accumulo Data Store &mdash; GeoMesa 1.2.7-SNAPSHOT Manuals</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme_custom.css" type="text/css" />
  

  

  
    <link rel="top" title="GeoMesa 1.2.7-SNAPSHOT Manuals" href="../index.html"/>
        <link rel="up" title="User Manual" href="index.html"/>
        <link rel="next" title="Kafka Data Store" href="kafka_datastore.html"/>
        <link rel="prev" title="GeoMesa Data Stores" href="datastores.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.2.7-SNAPSHOT
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation_and_configuration.html">Installation and Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="datastores.html">GeoMesa Data Stores</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Accumulo Data Store</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bootstrapping-geomesa-accumulo-on-elastic-map-reduce">Bootstrapping GeoMesa Accumulo on Elastic Map Reduce</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#zookeeper-session-timeout">Zookeeper session timeout</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-data-store">Creating a Data Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-the-accumulo-data-store-in-geoserver">Using the Accumulo Data Store in GeoServer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visibilities">Visibilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indexing-strategies">Indexing Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#explaining-query-plans">Explaining: Query Plans</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iterator-stack">Iterator Stack</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kafka_datastore.html">Kafka Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="hbase_datastore.html">HBase/Bigtable Data Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="cassandra_datastore.html">Cassandra Data Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Modules and Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="geoserver.html">GeoMesa GeoServer Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="spark.html">GeoMesa Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="commandline_tools.html">Command Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_management.html">Data Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">GeoMesa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">User Manual</a> &raquo;</li>
      
    <li>Accumulo Data Store</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user/accumulo_datastore.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="accumulo-data-store">
<h1>Accumulo Data Store<a class="headerlink" href="#accumulo-data-store" title="Permalink to this headline">¶</a></h1>
<p>The GeoMesa Accumulo Data Store module (<code class="docutils literal"><span class="pre">geomesa-accumulo</span></code> in the source distribution)
contains all of the Accumulo-related code for GeoMesa. This includes client code and
distributed iterator code for the Accumulo tablet servers.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Use of the Accumulo data store requires that the distributed runtime JAR be installed on the tablet servers, described in more detail in <a class="reference internal" href="installation_and_configuration.html#install-accumulo-runtime"><span>Installing the Accumulo Distributed Runtime Library</span></a>.</p>
<div class="section" id="bootstrapping-geomesa-accumulo-on-elastic-map-reduce">
<h3>Bootstrapping GeoMesa Accumulo on Elastic Map Reduce<a class="headerlink" href="#bootstrapping-geomesa-accumulo-on-elastic-map-reduce" title="Permalink to this headline">¶</a></h3>
<p>A script to bootstrap GeoMesa Accumulo on an Elastic Map Reduce cluster is provided in <code class="docutils literal"><span class="pre">geomesa-tools/emr4</span></code> and on this public S3 bucket: <a class="reference external" href="http://s3.amazonaws.com/elasticmapreduce-geomesa/">s3://elasticmapreduce-geomesa/</a>. These rely on the EMR managed Hadoop and ZooKeeper applications. See <code class="docutils literal"><span class="pre">geomesa-tools/emr4/README.md</span></code> for more details on using these clusters. The command below launches a GeoMesa EMR cluster:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">NUM_WORKERS</span><span class="o">=</span>2
<span class="nv">CLUSTER_NAME</span><span class="o">=</span>geomesa-emr
<span class="nv">AWS_REGION</span><span class="o">=</span>us-east-1
<span class="nv">AWS_PROFILE</span><span class="o">=</span>my_profile
<span class="nv">KEYPAIR_NAME</span><span class="o">=</span>my_keypair <span class="c1"># a keypair in the region (for which you have the private key)</span>

aws emr create-cluster --applications <span class="nv">Name</span><span class="o">=</span>Hadoop <span class="nv">Name</span><span class="o">=</span>ZooKeeper-Sandbox <span class="se">\</span>
    --bootstrap-actions <span class="nv">Path</span><span class="o">=</span>s3://elasticmapreduce-geomesa/bootstrap-geomesa.sh,Name<span class="o">=</span>geomesa-accumulo <span class="se">\</span>
    --ec2-attributes <span class="nv">KeyName</span><span class="o">=</span><span class="nv">$KEYPAIR_NAME</span>,InstanceProfile<span class="o">=</span>EMR_EC2_DefaultRole <span class="se">\</span>
    --service-role EMR_DefaultRole <span class="se">\</span>
    --release-label emr-4.7.1 --name <span class="nv">$CLUSTER_NAME</span> <span class="se">\</span>
    --instance-groups <span class="nv">InstanceCount</span><span class="o">=</span><span class="nv">$NUM_WORKERS</span>,InstanceGroupType<span class="o">=</span>CORE,InstanceType<span class="o">=</span>m3.xlarge <span class="nv">InstanceCount</span><span class="o">=</span>1,InstanceGroupType<span class="o">=</span>MASTER,InstanceType<span class="o">=</span>m3.xlarge <span class="se">\</span>
    --region <span class="nv">$AWS_REGION</span> --profile <span class="nv">$AWS_PROFILE</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="zookeeper-session-timeout">
<h3>Zookeeper session timeout<a class="headerlink" href="#zookeeper-session-timeout" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://accumulo.apache.org/1.6/accumulo_user_manual#_instance_zookeeper_timeout">Zookeeper session timeout</a>
for the GeoMesa Accumulo data store is exposed as the Java system property <code class="docutils literal"><span class="pre">instance.zookeeper.timeout</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">&quot;-Dinstance.zookeeper.timeout=10s&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-a-data-store">
<h2>Creating a Data Store<a class="headerlink" href="#creating-a-data-store" title="Permalink to this headline">¶</a></h2>
<p>An instance of an Accumulo data store can be obtained through the normal GeoTools discovery methods, assuming that the GeoMesa code is on the classpath:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;;</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;instanceId&quot;</span><span class="o">,</span> <span class="s">&quot;myInstance&quot;</span><span class="o">);</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;zookeepers&quot;</span><span class="o">,</span> <span class="s">&quot;zoo1,zoo2,zoo3&quot;</span><span class="o">);</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="s">&quot;myUser&quot;</span><span class="o">);</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span> <span class="s">&quot;myPassword&quot;</span><span class="o">);</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;tableName&quot;</span><span class="o">,</span> <span class="s">&quot;my_table&quot;</span><span class="o">);</span>
<span class="n">org</span><span class="o">.</span><span class="na">geotools</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">DataStore</span> <span class="n">dataStore</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">geotools</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">DataStoreFinder</span><span class="o">.</span><span class="na">getDataStore</span><span class="o">(</span><span class="n">parameters</span><span class="o">);</span>
</pre></div>
</div>
<p>More information on using GeoTools can be found in the <a class="reference external" href="http://docs.geotools.org/stable/userguide/">GeoTools user guide</a>.</p>
</div>
<div class="section" id="using-the-accumulo-data-store-in-geoserver">
<h2>Using the Accumulo Data Store in GeoServer<a class="headerlink" href="#using-the-accumulo-data-store-in-geoserver" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="geoserver.html"><em>GeoMesa GeoServer Plugins</em></a>.</p>
</div>
<div class="section" id="visibilities">
<h2>Visibilities<a class="headerlink" href="#visibilities" title="Permalink to this headline">¶</a></h2>
<p>The GeoMesa Accumulo data store supports Accumulo visibilities for securing data
at data store, feature, or individual attribute levels.</p>
<p>See <a class="reference internal" href="data_management.html#accumulo-visibilities"><span>Accumulo Visibilities</span></a> for more information.</p>
</div>
<div class="section" id="indexing-strategies">
<h2>Indexing Strategies<a class="headerlink" href="#indexing-strategies" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa uses several different strategies to index simple features. In the code, these strategies are abstracted as &#8216;tables&#8217;. For details on how GeoMesa encodes and indexes data, see <a class="reference internal" href="data_management.html#index-structure"><span>Index Structure</span></a>. The <a class="reference internal" href="data_management.html"><em>Data Management</em></a> chapter also describes how to optimize these indexes by manipulating <a class="reference internal" href="data_management.html#attribute-indices"><span>Attribute Indices</span></a>, <a class="reference internal" href="data_management.html#customizing-z-index"><span>Customizing the Z-Index</span></a>, and <a class="reference internal" href="data_management.html#customizing-index-creation"><span>Customizing Index Creation</span></a>.</p>
<p>For details on how GeoMesa chooses and executes queries, see the <a class="reference external" href="https://github.com/locationtech/geomesa/blob/master/geomesa-accumulo/geomesa-accumulo-datastore/src/main/scala/org/locationtech/geomesa/accumulo/index/QueryPlanner.scala">org.locationtech.geomesa.accumulo.index.QueryPlanner</a> and <a class="reference external" href="https://github.com/locationtech/geomesa/blob/master/geomesa-accumulo/geomesa-accumulo-datastore/src/main/scala/org/locationtech/geomesa/accumulo/index/QueryStrategyDecider.scala">org.locationtech.geomesa.accumulo.index.QueryStrategyDecider</a> classes.</p>
</div>
<div class="section" id="explaining-query-plans">
<span id="explain-query"></span><h2>Explaining: Query Plans<a class="headerlink" href="#explaining-query-plans" title="Permalink to this headline">¶</a></h2>
<p>Given a data store and a query, you can ask GeoMesa to explain its plan for how to execute the query:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">dataStore</span><span class="o">.</span><span class="na">getQueryPlan</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="n">explainer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExplainPrintln</span><span class="o">);</span>
</pre></div>
</div>
<p>Instead of <code class="docutils literal"><span class="pre">ExplainPrintln</span></code>, you can also use <code class="docutils literal"><span class="pre">ExplainString</span></code> or <code class="docutils literal"><span class="pre">ExplainLogging</span></code> to redirect the explainer output elsewhere.</p>
<p>For enabling <code class="docutils literal"><span class="pre">ExplainLogging</span></code> in GeoServer, see <a class="reference internal" href="geoserver.html#geoserver-explain-query"><span>Logging Explain Query Planning</span></a>. It may also be helpful to refer to GeoServer&#8217;s <a class="reference external" href="http://docs.geoserver.org/stable/en/user/configuration/logging.html">Advanced log configuration</a> documentation for the specifics of how and where to manage the GeoServer logs.</p>
<p>Knowing the plan &#8211; including information such as the indexing strategy &#8211; can be useful when you need to debug slow queries.  It can suggest when indexes should be added as well as when query-hints may expedite execution times.</p>
</div>
<div class="section" id="iterator-stack">
<h2>Iterator Stack<a class="headerlink" href="#iterator-stack" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa uses Accumulo iterators to push processing out to the whole cluster. The iterator stack can be considered a &#8216;tight inner loop&#8217; - generally, every feature returned will be processed in the iterators. As such, the iterators have been written for performance over readability.</p>
<p>We use several techniques to improve iterator performance. For one, we only deserialize the attributes of a simple feature that we need to evaluate a given query. When retrieving attributes, we always look them up by index, instead of by name. For aggregating queries, we create partial aggregates in the iterators, instead of doing all the processing in the client. The main goals are to minimize disk reads, processing and bandwidth as much as possible.</p>
<p>For more details, see the <a class="reference external" href="https://github.com/locationtech/geomesa/tree/master/geomesa-accumulo/geomesa-accumulo-datastore/src/main/scala/org/locationtech/geomesa/accumulo/iterators">org.locationtech.geomesa.accumulo.iterators</a> package.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="kafka_datastore.html" class="btn btn-neutral float-right" title="Kafka Data Store" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="datastores.html" class="btn btn-neutral" title="GeoMesa Data Stores" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2016 Commonwealth Computer Research, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.2.7-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>