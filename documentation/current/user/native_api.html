

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GeoMesa Native API &mdash; GeoMesa 1.3.2-SNAPSHOT Manuals</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme_custom.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/sphinx_tabs/tabs.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/segment.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/menu.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.css" type="text/css" />
  

  
    <link rel="top" title="GeoMesa 1.3.2-SNAPSHOT Manuals" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.3.2-SNAPSHOT
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">GeoMesa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>GeoMesa Native API</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user/native_api.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="geomesa-native-api">
<h1>GeoMesa Native API<a class="headerlink" href="#geomesa-native-api" title="Permalink to this headline">¶</a></h1>
<p>The GeoMesa Native API (<tt class="docutils literal"><span class="pre">geomesa-native-api</span></tt> in the source distribution) is for developers who prefer not to use GeoTools interfaces and just want to geo index their
data.  It exposes a simple interface for persisting and querying GeoMesa as well as a simple integration point with
Geoserver in cases where OGC access is still desired.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>To interact with the GeoMesa Native API, instantiate an instance of a <tt class="docutils literal"><span class="pre">GeoMesaIndex&lt;T&gt;</span></tt> with your payload type <tt class="docutils literal"><span class="pre">T</span></tt>.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">GeoMesaIndex</span><span class="o">&lt;</span><span class="n">DomainObject</span><span class="o">&gt;</span> <span class="n">index</span> <span class="o">=</span>
                <span class="n">AccumuloGeoMesaIndex</span><span class="o">.</span><span class="na">build</span><span class="o">(</span>
                    <span class="s">&quot;hello&quot;</span><span class="o">,</span>
                    <span class="s">&quot;zoo1:2181&quot;</span><span class="o">,</span>
                    <span class="s">&quot;mycloud&quot;</span><span class="o">,</span>
                    <span class="s">&quot;myuser&quot;</span><span class="o">,</span> <span class="s">&quot;mypass&quot;</span><span class="o">,</span>
                    <span class="kc">true</span><span class="o">,</span>
                    <span class="k">new</span> <span class="nf">DomainObjectValueSerializer</span><span class="o">(),</span>
                    <span class="k">new</span> <span class="n">DefaultSimpleFeatureView</span><span class="o">&lt;</span><span class="n">DomainObject</span><span class="o">&gt;(</span><span class="s">&quot;foo&quot;</span><span class="o">));</span>
</pre></div>
</div>
<p>In the code snippet above, we are instantiating an <tt class="docutils literal"><span class="pre">AccumuloGeoMesaIndex</span></tt> with a type parameter of <tt class="docutils literal"><span class="pre">DomainObject</span></tt>, the
payload object type that is specific to each usage of the native API.  We have provided a <tt class="docutils literal"><span class="pre">DomainObjectValueSerializer</span></tt>
an implementation of <tt class="docutils literal"><span class="pre">ValueSerializer</span></tt> which tells the native API how to convert the domain object into a byte array
payload.  We have also provided a <tt class="docutils literal"><span class="pre">DefaultSimpleFeatureView</span></tt> which maintains integration with the Geotools infrastructure.
The <tt class="docutils literal"><span class="pre">DefaultSimpleFeatureView</span></tt> will create a <tt class="docutils literal"><span class="pre">SimpleFeatureType</span></tt> that contains the geometry, date, and identifier of the
<tt class="docutils literal"><span class="pre">DomainObject</span></tt> and enable querying based on these attributes.  If you want to enable querying on more attributes from
your domain object, you should create a class that extends <tt class="docutils literal"><span class="pre">SimpleFeatureView</span></tt> and converts the domain object into a
rich <tt class="docutils literal"><span class="pre">SimpleFeature</span></tt>.  You can then leverage GeoMesa&#8217;s secondary indexing optimizations on first class attributes.</p>
<p>Persisting data to a <tt class="docutils literal"><span class="pre">GeoMesaIndex</span></tt> requires utilizing the various <tt class="docutils literal"><span class="pre">insert</span></tt> methods.  The following code snippet demonstrates
how you can put domain objects into the index.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">final</span> <span class="n">GeometryFactory</span> <span class="n">gf</span> <span class="o">=</span> <span class="n">JTSFactoryFinder</span><span class="o">.</span><span class="na">getGeometryFactory</span><span class="o">();</span>
<span class="n">DomainObject</span> <span class="n">one</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DomainObject</span><span class="o">();</span>
<span class="n">DomainObject</span> <span class="n">two</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DomainObject</span><span class="o">();</span>
<span class="n">index</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span>
    <span class="n">one</span><span class="o">,</span>
    <span class="n">gf</span><span class="o">.</span><span class="na">createPoint</span><span class="o">(</span><span class="k">new</span> <span class="n">Coordinate</span><span class="o">(-</span><span class="mf">78.0</span><span class="o">,</span> <span class="mf">38.0</span><span class="o">)),</span>
    <span class="n">date</span><span class="o">(</span><span class="s">&quot;2016-01-01T12:15:00.000Z&quot;</span><span class="o">));</span>
<span class="n">index</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span>
    <span class="n">two</span><span class="o">,</span>
    <span class="n">gf</span><span class="o">.</span><span class="na">createPoint</span><span class="o">(</span><span class="k">new</span> <span class="n">Coordinate</span><span class="o">(-</span><span class="mf">78.0</span><span class="o">,</span> <span class="mf">40.0</span><span class="o">)),</span>
    <span class="n">date</span><span class="o">(</span><span class="s">&quot;2016-02-01T12:15:00.000Z&quot;</span><span class="o">));</span>
</pre></div>
</div>
<p>The code above will compute an identifier for each of the domain objects.  If you want to control the identifiers,
use the <tt class="docutils literal"><span class="pre">insert</span></tt> methods with <tt class="docutils literal"><span class="pre">id</span></tt> in the signature.  If you do not intend to query GeoMesa using the specific identifiers of
your domain object, prefer the method that generates an identifier for you.  The reason is that the identifier chosen by
GeoMesa optimizes the locality properties of the identifier and thus the caching within the underlying database.</p>
<dl class="docutils">
<dt>To query data stored using the GeoMesa Native API, build up a <tt class="docutils literal"><span class="pre">GeoMesaQuery</span></tt> and pass it to the <tt class="docutils literal"><span class="pre">GeoMesaIndex</span></tt>.</dt>
<dd>For example, the following code snippet queries GeoMesa on space and time.</dd>
</dl>
<div class="highlight-java"><div class="highlight"><pre><span class="n">GeoMesaQuery</span> <span class="n">q</span> <span class="o">=</span>
    <span class="n">GeoMesaQuery</span><span class="o">.</span><span class="na">GeoMesaQueryBuilder</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">within</span><span class="o">(-</span><span class="mf">79.0</span><span class="o">,</span> <span class="mf">37.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">77.0</span><span class="o">,</span> <span class="mf">39.0</span><span class="o">)</span>
        <span class="o">.</span><span class="na">during</span><span class="o">(</span><span class="n">date</span><span class="o">(</span><span class="s">&quot;2016-01-01T00:00:00.000Z&quot;</span><span class="o">),</span> <span class="n">date</span><span class="o">(</span><span class="s">&quot;2016-03-01T00:00:00.000Z&quot;</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Iterable</span><span class="o">&lt;</span><span class="n">DomainObject</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">q</span><span class="o">);</span>
</pre></div>
</div>
<p>If you have used a custom <tt class="docutils literal"><span class="pre">SimpleFeatureView</span></tt>, you can query on the attributes you&#8217;ve lifted into the <tt class="docutils literal"><span class="pre">SimpleFeatureType</span></tt>.
For instance, if you have lifted an attribute called <tt class="docutils literal"><span class="pre">age</span></tt> into the <tt class="docutils literal"><span class="pre">SimpleFeatureType</span></tt>, you can query on it as follows and
GeoMesa will push the <tt class="docutils literal"><span class="pre">age</span></tt> predicate down for processing in the database.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">FilterFactory</span> <span class="n">ff</span> <span class="o">=</span> <span class="n">CommonFactoryFinder</span><span class="o">.</span><span class="na">getFilterFactory2</span><span class="o">();</span>
<span class="n">GeoMesaQuery</span> <span class="n">q</span> <span class="o">=</span>
    <span class="n">GeoMesaQuery</span><span class="o">.</span><span class="na">GeoMesaQueryBuilder</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">within</span><span class="o">(-</span><span class="mf">79.0</span><span class="o">,</span> <span class="mf">37.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">77.0</span><span class="o">,</span> <span class="mf">39.0</span><span class="o">)</span>
        <span class="o">.</span><span class="na">during</span><span class="o">(</span><span class="n">date</span><span class="o">(</span><span class="s">&quot;2016-01-01T00:00:00.000Z&quot;</span><span class="o">),</span> <span class="n">date</span><span class="o">(</span><span class="s">&quot;2016-03-01T00:00:00.000Z&quot;</span><span class="o">))</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">ff</span><span class="o">.</span><span class="na">greaterThan</span><span class="o">(</span><span class="n">ff</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">),</span> <span class="mi">30</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Iterable</span><span class="o">&lt;</span><span class="n">DomainObject</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">q</span><span class="o">);</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2017 Commonwealth Computer Research, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.2-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../_static/sphinx_tabs/tabs.js"></script>
      <script type="text/javascript" src="../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>