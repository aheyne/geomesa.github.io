<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Map-Reduce Ingest of GDELT &mdash; GeoMesa 1.2.0 Manuals</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GeoMesa 1.2.0 Manuals" href="../index.html" />
    <link rel="up" title="GeoMesa 1.2.0 Tutorials" href="index.html" />
    <link rel="next" title="GeoMesa Raster Support" href="geomesa-raster.html" />
    <link rel="prev" title="GeoMesa Storm Quick Start" href="geomesa-quickstart-storm.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="geomesa-raster.html" title="GeoMesa Raster Support"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="geomesa-quickstart-storm.html" title="GeoMesa Storm Quick Start"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">GeoMesa 1.2.0 Manuals</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">GeoMesa 1.2.0 Tutorials</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Map-Reduce Ingest of GDELT</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#obtaining-gdelt-data">Obtaining GDELT data</a><ul>
<li><a class="reference internal" href="#building-the-tutorial-code">Building the tutorial code</a></li>
<li><a class="reference internal" href="#running-the-ingest">Running the ingest</a></li>
</ul>
</li>
<li><a class="reference internal" href="#datastore-initialization">DataStore Initialization</a></li>
<li><a class="reference internal" href="#mapper">Mapper</a></li>
<li><a class="reference internal" href="#analyze">Analyze</a><ul>
<li><a class="reference internal" href="#geoserver-setup">GeoServer Setup</a></li>
<li><a class="reference internal" href="#register-the-geomesa-datastore-with-geoserver">Register the GeoMesa DataStore with GeoServer</a></li>
<li><a class="reference internal" href="#publish-layer">Publish layer</a></li>
<li><a class="reference internal" href="#query">Query</a></li>
<li><a class="reference internal" href="#filter">Filter</a></li>
<li><a class="reference internal" href="#heatmaps">Heatmaps</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="geomesa-quickstart-storm.html"
                        title="previous chapter">GeoMesa Storm Quick Start</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="geomesa-raster.html"
                        title="next chapter">GeoMesa Raster Support</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorials/geomesa-examples-gdelt.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="map-reduce-ingest-of-gdelt">
<h1>Map-Reduce Ingest of GDELT<a class="headerlink" href="#map-reduce-ingest-of-gdelt" title="Permalink to this headline">¶</a></h1>
<p>This tutorial shows how to:</p>
<ol class="arabic simple">
<li>Ingest big <a class="reference external" href="http://www.gdeltproject.org">GDELT</a> data files into a
GeoMesa Accumulo table via a Hadoop Map/Reduce job.</li>
<li>Leverage GeoServer to query and visualize the data.</li>
</ol>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You will need access to a Hadoop 2.2.2 or better
installation as well as an Accumulo 1.5 or 1.6 database.</p>
</div>
<p>You will also need:</p>
<ul class="simple">
<li>access to an Accumulo user that has both create-table and write
permissions,</li>
<li>an instance of GeoServer 2.8.1 with the GeoMesa plugin installed,</li>
<li>Java JDK 7,</li>
<li><a class="reference external" href="http://maven.apache.org">Apache Maven</a> 3.2.2 or better, and</li>
<li>a <a class="reference external" href="http://git-scm.com">git</a> client.</li>
</ul>
</div>
<div class="section" id="obtaining-gdelt-data">
<h2>Obtaining GDELT data<a class="headerlink" href="#obtaining-gdelt-data" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://www.gdeltproject.org">GDELT Event database</a> provides a
comprehensive time- and location-indexed archive of events reported in
broadcast, print, and web news media worldwide from 1979 to today. You
can download raw GDELT data files at
<a class="reference external" href="http://data.gdeltproject.org/events/index.html">http://data.gdeltproject.org/events/index.html</a>. For example, the
following Bash commands use <code class="docutils literal"><span class="pre">wget</span></code> to download all event files for
2013 and 2014 (5 GB compressed, 30 GB uncompressed) and <code class="docutils literal"><span class="pre">md5sum</span></code> to
verify each by their MD5 hash:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mkdir gdelt <span class="o">&amp;&amp;</span> <span class="nb">cd </span>gdelt
<span class="nv">$ </span>wget http://data.gdeltproject.org/events/md5sums
<span class="nv">$ </span><span class="k">for</span> file in <span class="sb">`</span>cat md5sums <span class="p">|</span> cut -d<span class="s1">&#39; &#39;</span> -f3 <span class="p">|</span> grep <span class="s1">&#39;^201[34]&#39;</span><span class="sb">`</span> <span class="p">;</span> <span class="k">do</span> wget http://data.gdeltproject.org/events/<span class="nv">$file</span> <span class="p">;</span> <span class="k">done</span>
<span class="nv">$ </span>md5sum -c md5sums 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep <span class="s1">&#39;^201[34]&#39;</span>
</pre></div>
</div>
<p>Note: the whole GDELT data set is very large, over 100 GB compressed and
over 1 TB uncompressed. We download all data for 2013-2014 as we look at
events in the Ukraine in this time period in the <strong>ANALYZE</strong> section
below. However, you may load a smaller dataset for demonstration
purposes; data for a typical month is about ~2 GB uncompressed, but you
will see fewer data in the analysis below. In any case, omit the
aggregated, reduced GDELT data in
<code class="docutils literal"><span class="pre">GDELT.MASTERREDUCEDV2.1979-2013.zip</span></code>, which has fewer columns than
the fully-described event data in the other files, and is not supported
by the ingest code described below.</p>
<p>In the directory with the <code class="docutils literal"><span class="pre">*.zip</span></code> data files, use the following
command to unpack and aggregate them into a file called <code class="docutils literal"><span class="pre">gdelt.tsv</span></code> on
the Hadoop file system:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="o">(</span>ls -1 *.zip <span class="p">|</span> xargs -n <span class="m">1</span> zcat<span class="o">)</span> <span class="p">|</span> hadoop fs -put - /gdelt/uncompressed/gdelt.tsv
</pre></div>
</div>
<p>Note: the individual files, when uncompressed, have <code class="docutils literal"><span class="pre">*.csv</span></code>
extensions, but the data contained within them are tab-separated values,
hence the <code class="docutils literal"><span class="pre">*.tsv</span></code> extension. See the <a class="reference external" href="http://www.gdeltproject.org/data.html#rawdatafiles">GDELT raw data file
documentation</a>
for more information on the format of these files.</p>
<div class="section" id="building-the-tutorial-code">
<h3>Building the tutorial code<a class="headerlink" href="#building-the-tutorial-code" title="Permalink to this headline">¶</a></h3>
<p>Clone the geomesa project and build it, if you haven&#8217;t already:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git clone https://github.com/locationtech/geomesa.git
<span class="nv">$ </span><span class="nb">cd </span>geomesa
<span class="nv">$ </span>mvn clean install
</pre></div>
</div>
<p>This is needed to install the GeoMesa JAR files in your local Maven
repository. For more information see the <a class="reference internal" href="geomesa-quickstart-accumulo.html"><em>GeoMesa Accumulo Quick Start</em></a> tutorial.</p>
<p>Clone the geomesa-tutorials project and build it:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git clone https://github.com/geomesa/geomesa-tutorials.git
</pre></div>
</div>
<p>The example code is in <code class="docutils literal"><span class="pre">geomesa-examples-gdelt</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>geomesa-tutorials/geomesa-examples-gdelt
<span class="nv">$ </span>mvn clean install
</pre></div>
</div>
<p>After building, the built JAR file bundled with all dependencies will be
in the <code class="docutils literal"><span class="pre">target</span></code> subdirectory.</p>
</div>
<div class="section" id="running-the-ingest">
<h3>Running the ingest<a class="headerlink" href="#running-the-ingest" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal"><span class="pre">hadoop</span> <span class="pre">jar</span></code> to launch the Map/Reduce ingest job:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>hadoop jar ./target/geomesa-examples-<span class="nv">$VERSION</span>.jar <span class="se">\</span>
   com.example.geomesa.gdelt.GDELTIngest           <span class="se">\</span>
   -instanceId &lt;accumulo-instance-id&gt;              <span class="se">\</span>
   -zookeepers &lt;zookeeper-hosts-string&gt;            <span class="se">\</span>
   -user &lt;username&gt; -password &lt;password&gt;           <span class="se">\</span>
   -auths &lt;comma-separated-authorization-string&gt;   <span class="se">\</span>
   -tableName gdelt -featureName event             <span class="se">\</span>
   -ingestFile hdfs:///gdelt/uncompressed/gdelt.tsv
</pre></div>
</div>
<p>Note that authorizations are optional. Unless you know that your table
already exists with explicit authorizations, or that it will be created
with default authorizations, you probably want to omit this parameter.</p>
</div>
</div>
<div class="section" id="datastore-initialization">
<h2>DataStore Initialization<a class="headerlink" href="#datastore-initialization" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://www.geotools.org">GeoTools</a> uses a <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> to
represent the schema for individual <code class="docutils literal"><span class="pre">SimpleFeatures</span></code> created from the
GDELT data. We can easily create a schema for the GDELT
<code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> using the <a class="reference external" href="http://docs.geotools.org/latest/userguide/library/main/feature.html">GeoTools DataUtilities
class</a>.
The schema string is a comma separated list of attribute descriptors of
the form &#8221;:&#8221;, e.g. &#8220;Year:Integer&#8221;. Some attributes may have a third term
with an appended &#8220;hint&#8221;, e.g. &#8220;geom:Point:srid=4236&#8221;, and the default
geometry attribute is often prepended with an asterisk. For example, a
complete schema string for a <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> describing a city
with a latitude/longitude point, a name, and a population might be
&#8220;*geom:Point:srid=4326,cityname:String,population:Integer&#8221;.</p>
<p>This is how <code class="docutils literal"><span class="pre">GDELTIngest.java</span></code> creates the <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> for
the GDELT event data:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="n">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">(</span>
    <span class="s">&quot;GLOBALEVENTID:Integer&quot;</span><span class="o">,</span>
    <span class="s">&quot;SQLDATE:Date&quot;</span><span class="o">,</span>
    <span class="s">&quot;MonthYear:Integer&quot;</span><span class="o">,</span>
    <span class="s">&quot;Year:Integer&quot;</span><span class="o">,</span>
    <span class="s">&quot;FractionDate:Float&quot;</span><span class="o">,</span>
    <span class="c1">//...</span>
    <span class="s">&quot;*geom:Point:srid=4326&quot;</span>
<span class="o">);</span>
<span class="n">String</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">Joiner</span><span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>
<span class="n">SimpleFeatureType</span> <span class="n">featureType</span> <span class="o">=</span> <span class="n">DataUtilities</span><span class="o">.</span><span class="na">createType</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">spec</span><span class="o">);</span>
</pre></div>
</div>
<p>After we create the GDELT feature type, we have to tell GeoMesa which
field to use for the date index. We specify this field using the
<code class="docutils literal"><span class="pre">SimpleFeatureType</span></code>&#8216;s user data.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//This tells GeoMesa to use this Attribute as the Start Time index</span>
<span class="n">featureType</span><span class="o">.</span><span class="na">getUserData</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="n">Constants</span><span class="o">.</span><span class="na">SF_PROPERTY_START_TIME</span><span class="o">,</span> <span class="s">&quot;SQLDATE&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>Finally, we create the new feature type in GeoMesa as follows.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ds</span><span class="o">.</span><span class="na">createSchema</span><span class="o">(</span><span class="n">featureType</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="mapper">
<h2>Mapper<a class="headerlink" href="#mapper" title="Permalink to this headline">¶</a></h2>
<p>In the <code class="docutils literal"><span class="pre">setup</span></code> method of the Mapper class, we grab the connection
params from the <code class="docutils literal"><span class="pre">JobContext</span></code> and get a handle on a <code class="docutils literal"><span class="pre">FeatureWriter</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">DataStore</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">DataStoreFinder</span><span class="o">.</span><span class="na">getDataStore</span><span class="o">(</span><span class="n">connectionParams</span><span class="o">);</span>
<span class="n">featureType</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="na">getSchema</span><span class="o">(</span><span class="n">featureName</span><span class="o">);</span>
<span class="n">featureBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleFeatureBuilder</span><span class="o">(</span><span class="n">featureType</span><span class="o">);</span>
<span class="n">featureWriter</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="na">getFeatureWriter</span><span class="o">(</span><span class="n">featureName</span><span class="o">,</span> <span class="n">Transaction</span><span class="o">.</span><span class="na">AUTO_COMMIT</span><span class="o">);</span>
</pre></div>
</div>
<p>The input to the map method is a single line of the GDELT TSV file. We
split the line on tabs and extract the attributes of the data. We parse
the latitude and longitude field to set the default geometry of our
<code class="docutils literal"><span class="pre">SimpleFeature</span></code>.</p>
<p>GeoTools provides common conversions for most data types and some date
formats. However, any attribute strings that will not convert
automatically into the specified class need to be explicitly set on the
<code class="docutils literal"><span class="pre">SimpleFeature</span></code>. See &#8220;SQLDATE&#8221; below.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">featureBuilder</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
<span class="n">featureBuilder</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>

<span class="n">Double</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">attributes</span><span class="o">[</span><span class="n">LATITUDE_COL_IDX</span><span class="o">]);</span>
<span class="n">Double</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">attributes</span><span class="o">[</span><span class="n">LONGITUDE_COL_IDX</span><span class="o">]);</span>
<span class="n">Geometry</span> <span class="n">geom</span> <span class="o">=</span> <span class="n">geometryFactory</span><span class="o">.</span><span class="na">createPoint</span><span class="o">(</span><span class="k">new</span> <span class="n">Coordinate</span><span class="o">(</span><span class="n">lon</span><span class="o">,</span> <span class="n">lat</span><span class="o">));</span>
<span class="n">SimpleFeature</span> <span class="n">simpleFeature</span> <span class="o">=</span> <span class="n">featureBuilder</span><span class="o">.</span><span class="na">buildFeature</span><span class="o">(</span><span class="n">attributes</span><span class="o">[</span><span class="n">ID_COL_IDX</span><span class="o">]);</span>
<span class="n">simpleFeature</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;SQLDATE&quot;</span><span class="o">,</span> <span class="n">formatter</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">attributes</span><span class="o">[</span><span class="n">DATE_COL_IDX</span><span class="o">]));</span>
<span class="n">simpleFeature</span><span class="o">.</span><span class="na">setDefaultGeometry</span><span class="o">(</span><span class="n">geom</span><span class="o">);</span>

<span class="k">try</span> <span class="o">{</span> <span class="n">SimpleFeature</span> <span class="n">next</span> <span class="o">=</span> <span class="n">featureWriter</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="n">next</span><span class="o">.</span><span class="na">setAttributes</span><span class="o">(</span><span class="n">simpleFeature</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">());</span>
    <span class="o">((</span><span class="n">FeatureIdImpl</span><span class="o">)</span><span class="n">next</span><span class="o">.</span><span class="na">getIdentifier</span><span class="o">()).</span><span class="na">setID</span><span class="o">(</span><span class="n">simpleFeature</span><span class="o">.</span><span class="na">getID</span><span class="o">());</span>
    <span class="n">featureWriter</span><span class="o">.</span><span class="na">write</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="analyze">
<h2>Analyze<a class="headerlink" href="#analyze" title="Permalink to this headline">¶</a></h2>
<div class="section" id="geoserver-setup">
<h3>GeoServer Setup<a class="headerlink" href="#geoserver-setup" title="Permalink to this headline">¶</a></h3>
<p>First, follow <a class="reference internal" href="../user/installation_and_configuration.html"><em>Installation and Configuration</em></a> to set up the
GeoMesa GeoServer plugin if you haven&#8217;t done so.</p>
</div>
<div class="section" id="register-the-geomesa-datastore-with-geoserver">
<h3>Register the GeoMesa DataStore with GeoServer<a class="headerlink" href="#register-the-geomesa-datastore-with-geoserver" title="Permalink to this headline">¶</a></h3>
<p>Click &#8220;Stores&#8221; and &#8220;Add new Store&#8221;. If you do not see the Accumulo
Feature Data Store listed under Vector Data Sources, ensure the plugin
is in the right directory and restart GeoServer.</p>
<div class="figure" id="id1">
<img alt="Registering new Data Store" src="../_images/Accumulo_Feature_Data_Store.png" />
<p class="caption"><span class="caption-text">Registering a new Data Store</span></p>
</div>
<p>Register the newly created Accumulo table using the same parameters
specified in the command line above. (If you use a workspace:layer name
other than &#8220;geomesa:gdelt&#8221;, you will need to change the WMS requests
that follow.)</p>
<div class="figure" id="id2">
<img alt="Registering new Accumulo Feature Data Store" src="../_images/Geoserver_Accumulo_Store_Registration.png" />
<p class="caption"><span class="caption-text">Registering a new Accumulo Feature Data Store</span></p>
</div>
</div>
<div class="section" id="publish-layer">
<h3>Publish layer<a class="headerlink" href="#publish-layer" title="Permalink to this headline">¶</a></h3>
<p>After registering the DataStore, click to publish the layer. You will be
taken to the Edit Layer screen. In the Data pane, enter values for the
bounding boxes. For the whole world, use [-180,-90,180,90]. In the
Dimensions pane, enable Time and select the SQLDATE field. You will also
need to specify a presentation for time - use List as a default.</p>
<div class="figure" id="id3">
<img alt="Enable Time for the Layer" src="../_images/Edit_Layer_Enable_Time.png" />
<p class="caption"><span class="caption-text">Enable Time for the Layer</span></p>
</div>
</div>
<div class="section" id="query">
<h3>Query<a class="headerlink" href="#query" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s look at events in the Ukraine from 2013 until April 30, 2014. The
red squares are the default styling that GeoServer applies to point
data.</p>
<div class="highlight-bash"><div class="highlight"><pre>http://localhost:8080/geoserver/wms?service<span class="o">=</span>WMS<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span>1.1.0<span class="p">&amp;</span><span class="nv">request</span><span class="o">=</span>GetMap<span class="p">&amp;</span><span class="nv">layers</span><span class="o">=</span>geomesa:gdelt<span class="p">&amp;</span><span class="nv">styles</span><span class="o">=</span><span class="p">&amp;</span><span class="nv">bbox</span><span class="o">=</span>31.6,44,37.4,47.75<span class="p">&amp;</span><span class="nv">width</span><span class="o">=</span>1200<span class="p">&amp;</span><span class="nv">height</span><span class="o">=</span>600<span class="p">&amp;</span><span class="nv">srs</span><span class="o">=</span>EPSG:4326<span class="p">&amp;</span><span class="nv">format</span><span class="o">=</span>application/openlayers<span class="p">&amp;</span><span class="nv">TIME</span><span class="o">=</span>2013-01-01T00:00:00.000Z/2014-04-30T23:00:00.000Z
</pre></div>
</div>
<div class="figure" id="id4">
<img alt="Showing all GDELT events from Jan 1, 2013 to April 30, 2014" src="../_images/Ukraine_Unfiltered1.png" />
<p class="caption"><span class="caption-text">Showing all GDELT events from Jan 1, 2013 to April 30, 2014</span></p>
</div>
<p>The above map is using the <a class="reference external" href="http://maps.stamen.com/toner">Stamen
Toner</a> layer as a base layer. For more
information about adding multiple layers into one group see the
<a class="reference external" href="http://docs.geoserver.org/stable/en/user/webadmin/data/layergroups.html">GeoServer
documentation</a>.</p>
</div>
<div class="section" id="filter">
<h3>Filter<a class="headerlink" href="#filter" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s narrow our results. GDELT labels events with <a class="reference external" href="http://www.gdeltproject.org/data.html#documentation">CAMEO (Conflict and
Mediation Event
Observations)</a>
codes. The CAMEO code for events of type &#8216;THREATEN&#8217; starts with &#8216;13&#8217;. We
can filter down to these events using the drop down in GeoServer&#8217;s
OpenLayers preview.</p>
<div class="figure" id="id5">
<img alt="Open GeoServer Toggle Options Toolbar" src="../_images/Geoserver_Toggle_Options_Toolbar.png" />
<p class="caption"><span class="caption-text">Open GeoServer Toggle Options Toolbar</span></p>
</div>
<div class="figure" id="id6">
<img alt="Enter CQL Filter into Toolbar" src="../_images/Geoserver_Layer_Preview_Drop_Down.png" />
<p class="caption"><span class="caption-text">Enter CQL Filter into Toolbar</span></p>
</div>
<p>Let&#8217;s use a custom icon to display THREATEN events, by adding an <a class="reference external" href="http://docs.geoserver.org/latest/en/user/styling/index.html">SLD
style</a>
to the layer. Add the SLD file
<a class="reference download internal" href="../_downloads/threat.sld"><code class="xref download docutils literal"><span class="pre">threat.sld</span></code></a>
to GeoServer (See the GeoServer documentation for <a class="reference external" href="http://docs.geoserver.org/latest/en/user/styling/sld-working.html">more information
about adding SLD
files</a>.
For the ExternalGraphic in the SLD to work, move the image file to the
specified location in your GeoServer installation.</p>
<div class="highlight-bash"><div class="highlight"><pre>http://localhost:8080/geoserver/wms?service<span class="o">=</span>WMS<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span>1.1.0<span class="p">&amp;</span><span class="nv">request</span><span class="o">=</span>GetMap<span class="p">&amp;</span><span class="nv">layers</span><span class="o">=</span>geomesa:gdelt<span class="p">&amp;</span><span class="nv">CQL_FILTER</span><span class="o">=</span><span class="nv">EventRootCode</span><span class="o">=</span>13<span class="p">&amp;</span><span class="nv">styles</span><span class="o">=</span>threat<span class="p">&amp;</span><span class="nv">bbox</span><span class="o">=</span>31.6,44,37.4,47.75<span class="p">&amp;</span><span class="nv">width</span><span class="o">=</span>1200<span class="p">&amp;</span><span class="nv">height</span><span class="o">=</span>600<span class="p">&amp;</span><span class="nv">srs</span><span class="o">=</span>EPSG:4326<span class="p">&amp;</span><span class="nv">format</span><span class="o">=</span>application/openlayers<span class="p">&amp;</span><span class="nv">TIME</span><span class="o">=</span>2013-01-01T00:00:00.000Z/2014-04-30T23:00:00.000Z
</pre></div>
</div>
<img alt="../_images/Ukraine_Event_RootCode_Threaten.png" src="../_images/Ukraine_Event_RootCode_Threaten.png" />
</div>
<div class="section" id="heatmaps">
<h3>Heatmaps<a class="headerlink" href="#heatmaps" title="Permalink to this headline">¶</a></h3>
<p>Use a heatmap to more clearly visualize multiple events in the same
location or high volume of data in general. Add the SLD file
<a class="reference download internal" href="../_downloads/heatmap.sld"><code class="xref download docutils literal"><span class="pre">heatmap.sld</span></code></a> to
GeoServer.</p>
<p>In the request below, the heatmap is before the points layer so that the
points will be overlaid and not hidden. Notice the
&#8220;&amp;env=radiusPixels:30&#8221; in the URL; this is SLD variable substitution,
and will replace the default value assigned in the SLD.</p>
<div class="highlight-bash"><div class="highlight"><pre>http://localhost:8080/geoserver/wms?service<span class="o">=</span>WMS<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span>1.1.0<span class="p">&amp;</span><span class="nv">request</span><span class="o">=</span>GetMap<span class="p">&amp;</span><span class="nv">layers</span><span class="o">=</span>geomesa:gdelt,geomesa:gdelt<span class="p">&amp;</span><span class="nv">CQL_FILTER</span><span class="o">=</span>include<span class="p">;</span><span class="nv">EventRootCode</span><span class="o">=</span>13<span class="p">&amp;</span><span class="nv">styles</span><span class="o">=</span>heatmap,threat<span class="p">&amp;</span><span class="nv">bbox</span><span class="o">=</span>31.6,44,37.4,47.75<span class="p">&amp;</span><span class="nv">width</span><span class="o">=</span>1200<span class="p">&amp;</span><span class="nv">height</span><span class="o">=</span>600<span class="p">&amp;</span><span class="nv">srs</span><span class="o">=</span>EPSG:4326<span class="p">&amp;</span><span class="nv">format</span><span class="o">=</span>application/openlayers<span class="p">&amp;</span><span class="nv">TIME</span><span class="o">=</span>2013-01-01T00:00:00.000Z/2014-04-30T23:00:00.000Z<span class="p">&amp;</span><span class="nv">env</span><span class="o">=</span>radiusPixels:30
</pre></div>
</div>
<img alt="../_images/Heatmap_Ukraine_EventRootCode_Threaten.png" src="../_images/Heatmap_Ukraine_EventRootCode_Threaten.png" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="geomesa-raster.html" title="GeoMesa Raster Support"
             >next</a> |</li>
        <li class="right" >
          <a href="geomesa-quickstart-storm.html" title="GeoMesa Storm Quick Start"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">GeoMesa 1.2.0 Manuals</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >GeoMesa 1.2.0 Tutorials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, GeoMesa.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
  </body>
</html>