<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GeoMesa Kafka Quick Start &mdash; GeoMesa 1.2.0 Manuals</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="GeoMesa 1.2.0 Manuals" href="../index.html" />
    <link rel="up" title="GeoMesa 1.2.0 Tutorials" href="index.html" />
    <link rel="next" title="GeoMesa Storm Quick Start" href="geomesa-quickstart-storm.html" />
    <link rel="prev" title="GeoMesa Accumulo Quick-Start" href="geomesa-quickstart-accumulo.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoMesa</a>
        <span class="navbar-text navbar-version pull-left"><b>1.2.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">GeoMesa 1.2.0 User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">GeoMesa 1.2.0 Developer Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">GeoMesa 1.2.0 Tutorials</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">GeoMesa Kafka Quick Start</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#download-and-build-the-tutorial">Download and Build the Tutorial</a></li>
<li><a class="reference internal" href="#run-the-code">Run the Code</a></li>
<li><a class="reference internal" href="#register-the-layer-in-geoserver">Register the Layer in GeoServer</a></li>
<li><a class="reference internal" href="#publish-the-layer">Publish the Layer</a></li>
<li><a class="reference internal" href="#view-the-layer">View the layer</a></li>
<li><a class="reference internal" href="#produce-some-data">Produce Some Data</a></li>
<li><a class="reference internal" href="#what-s-happening-in-geoserver">What&#8217;s Happening in GeoServer</a></li>
<li><a class="reference internal" href="#consumers-explained">Consumers Explained</a></li>
<li><a class="reference internal" href="#view-the-consumer-output">View the Consumer Output</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="geomesa-quickstart-accumulo.html" title="Previous Chapter: GeoMesa Accumulo Quick-Start"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; GeoMesa Accum...</span>
    </a>
  </li>
  <li>
    <a href="geomesa-quickstart-storm.html" title="Next Chapter: GeoMesa Storm Quick Start"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">GeoMesa Storm... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/tutorials/geomesa-quickstart-kafka.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="geomesa-kafka-quick-start">
<h1>GeoMesa Kafka Quick Start<a class="headerlink" href="#geomesa-kafka-quick-start" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will introduce how to:</p>
<ol class="arabic simple">
<li>Write custom Java code to produce and consume messages in <a class="reference external" href="http://kafka.apache.org/">Apache
Kafka</a> using GeoMesa.</li>
<li>Query the data and replay the messages in a Kafka topic to achieve an
earlier state.</li>
<li>Visualize the changes being made in Kafka with GeoServer.</li>
</ol>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://kafka.apache.org/">Apache Kafka</a> is &#8220;publish-subscribe
messaging rethought as a distributed commit log.&#8221;</p>
<p>In the context of GeoMesa, Kafka is a useful tool for working with
streams of geospatial data. Interaction with Kafka in GeoMesa occurs
with the KafkaDataStore which implements the GeoTools
<a class="reference external" href="http://docs.geotools.org/latest/userguide/library/data/datastore.html">DataStore</a>
interface.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>basic knowledge of <a class="reference external" href="http://www.geotools.org">GeoTools</a>,
<a class="reference external" href="http://geoserver.org">GeoServer</a>, and Kafka,</li>
<li>an instance of Kafka 0.8.2.x with (an) appropriate Zookeeper
instance(s),</li>
<li>an instance of GeoServer version 2.8.1 with the GeoMesa Kafka plugin
installed,</li>
<li><a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java JDK
7</a>,</li>
<li><a class="reference external" href="http://maven.apache.org/">Apache Maven</a> 3.2.2 or better, and</li>
<li>a <a class="reference external" href="http://git-scm.com/">git</a> client.</li>
</ul>
<p>In order to install the GeoMesa Kafka GeoServer plugin, follow the
instructions
<a class="reference external" href="https://github.com/locationtech/geomesa/tree/master/geomesa-gs-plugin/geomesa-kafka-gs-plugin">here</a>.</p>
<p>Ensure your Kafka and Zookeeper instances are running. You can use
Kafka&#8217;s
<a class="reference external" href="http://kafka.apache.org/documentation.html#quickstart">quickstart</a>
to get Kafka/Zookeeper instances up and running quickly.</p>
</div>
<div class="section" id="download-and-build-the-tutorial">
<h2>Download and Build the Tutorial<a class="headerlink" href="#download-and-build-the-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Pick a reasonable directory on your machine, and run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git clone git@github.com:geomesa/geomesa-tutorials.git
<span class="nv">$ </span><span class="nb">cd </span>geomesa-tutorials
</pre></div>
</div>
<p>To build, run</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mvn clean install -pl geomesa-quickstart-kafka
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Ensure that the version of Kafka and Zookeeper in
the root <code class="docutils literal"><span class="pre">pom.xml</span></code> match your environment.</p>
<p class="last">Depending on the version, you may also need to build
GeoMesa locally. Instructions can be found in
<a class="reference internal" href="../user/installation_and_configuration.html"><em>Installation and Configuration</em></a>.</p>
</div>
</div>
<div class="section" id="run-the-code">
<h2>Run the Code<a class="headerlink" href="#run-the-code" title="Permalink to this headline">¶</a></h2>
<p>On the command-line, run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>java -cp geomesa-quickstart-kafka/target/geomesa-quickstart-kafka-<span class="si">${</span><span class="nv">geomesa</span><span class="p">.version</span><span class="si">}</span>.jar com.example.geomesa.kafka.KafkaQuickStart -brokers &lt;brokers&gt; -zookeepers &lt;zookeepers&gt;
</pre></div>
</div>
<p>where you provide the values for the following arguments:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;brokers&gt;</span></code> your Kafka broker instances, comma separated. For a
local install, this would be <code class="docutils literal"><span class="pre">localhost:9092</span></code>.</li>
<li><code class="docutils literal"><span class="pre">&lt;zookeepers&gt;</span></code> your Zookeeper nodes, comma separated. For a local
install, this would be <code class="docutils literal"><span class="pre">localhost:2181</span></code>.</li>
</ul>
<p>The program will create some metadata in Zookeeper and an associated
topic in your Kafka instance, and pause execution to let you add the
newly created <code class="docutils literal"><span class="pre">KafkaDataStore</span></code> to GeoServer. Once GeoServer has been
configured, we&#8217;ll pick back up with the paused program.</p>
</div>
<div class="section" id="register-the-layer-in-geoserver">
<h2>Register the Layer in GeoServer<a class="headerlink" href="#register-the-layer-in-geoserver" title="Permalink to this headline">¶</a></h2>
<p>Log into GeoServer using your credentials. Click “Stores” in the
left-hand gutter and “Add new Store”. If you do not see the Kafka Data
Store listed under Vector Data Sources, ensure the plugin and
dependencies are in the right directory and restart GeoServer.</p>
<p>Select the <code class="docutils literal"><span class="pre">Kafka</span> <span class="pre">Data</span> <span class="pre">Store</span></code> vector data source and enter the
following parameters:</p>
<ul class="simple">
<li>Basic Store Info</li>
<li><code class="docutils literal"><span class="pre">workspace</span></code> this is dependent upon your GeoServer installation</li>
<li><code class="docutils literal"><span class="pre">data</span> <span class="pre">source</span> <span class="pre">name</span></code> pick a sensible name, such as,
<code class="docutils literal"><span class="pre">geomesa_kafka_quickstart</span></code></li>
<li><code class="docutils literal"><span class="pre">description</span></code> pick a sensible description, such as
<code class="docutils literal"><span class="pre">GeoMesa</span> <span class="pre">Kafka</span> <span class="pre">quick</span> <span class="pre">start</span></code></li>
<li>Connection Parameters</li>
<li><code class="docutils literal"><span class="pre">brokers</span></code> your Kafka broker instances, comma separated. Use the
same ones you used on the command line.</li>
<li><code class="docutils literal"><span class="pre">zookeepers</span></code> your Zookeeper nodes, comma separated. Use the same
ones you used on the command line.</li>
</ul>
<p>Leave all other fields empty or with the default value.</p>
<p>Click &#8220;Save&#8221; and GeoServer will search your Kafka instance for any
GeoMesa-managed feature types.</p>
</div>
<div class="section" id="publish-the-layer">
<h2>Publish the Layer<a class="headerlink" href="#publish-the-layer" title="Permalink to this headline">¶</a></h2>
<p>GeoServer should find the <code class="docutils literal"><span class="pre">KafkaQuickStart</span></code> feature type and present
it as a layer that can be published. Click on the &#8220;Publish&#8221; link. You
will be taken to the Edit Layer screen.</p>
<p>You can leave most fields as default. In the Data pane, you&#8217;ll need to
enter values for the bounding boxes. In this case, you can click on the
links to compute these values from the data. Click &#8220;Save&#8221;.</p>
</div>
<div class="section" id="view-the-layer">
<h2>View the layer<a class="headerlink" href="#view-the-layer" title="Permalink to this headline">¶</a></h2>
<p>Click on the &#8220;Layer Preview&#8221; link in the left-hand gutter. If you don&#8217;t
see the quick-start layer on the first page of results, enter the name
of the layer you just created into the search box, and press &lt;Enter&gt;.</p>
<p>Once you see your layer, click on the &#8220;OpenLayers&#8221; link, which will open
a new tab. At this point, there are no messages in Kafka so nothing will
be shown.</p>
</div>
<div class="section" id="produce-some-data">
<h2>Produce Some Data<a class="headerlink" href="#produce-some-data" title="Permalink to this headline">¶</a></h2>
<p>Resume the program&#8217;s execution by inputting &lt;Enter&gt; in your terminal now
that the <code class="docutils literal"><span class="pre">KafkaDataStore</span></code> is registered in GeoServer. The program will
create two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s and then write a stream of updates to
the two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s over the course of about a minute.</p>
<p>You can refresh the GeoServer layer preview repeatedly to visualize the
updates being written to Kafka.</p>
</div>
<div class="section" id="what-s-happening-in-geoserver">
<h2>What&#8217;s Happening in GeoServer<a class="headerlink" href="#what-s-happening-in-geoserver" title="Permalink to this headline">¶</a></h2>
<p>The layer preview of GeoServer uses the
<code class="docutils literal"><span class="pre">LiveKafkaConsumerFeatureSource</span></code> to show a real time view of the
current state of the data stream. Two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s are being
updated over time in Kafka which is reflected in the GeoServer display.</p>
<p>As you refresh the page, you should see two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s that
start on the left side gradually move to the right side while crossing
each other in the middle. As the two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s get updated,
the older <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s disappear from the display.</p>
<img alt="&quot;GeoServer view&quot;" src="../_images/layer-preview.png" />
</div>
<div class="section" id="consumers-explained">
<h2>Consumers Explained<a class="headerlink" href="#consumers-explained" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa wraps Kafka consumers in two different ways; as a
<code class="docutils literal"><span class="pre">LiveKafkaConsumerFeatureSource</span></code> or a
<code class="docutils literal"><span class="pre">ReplayKafkaConsumerFeatureSource</span></code>. Both of these classes implement
GeoTools&#8217;
<a class="reference external" href="http://docs.geotools.org/latest/javadocs/org/geotools/data/FeatureSource.html">FeatureSource</a>
API.</p>
<p>The <code class="docutils literal"><span class="pre">LiveKafkaConsumerFeatureSource</span></code> will consume messages as they are
being produced and maintain the real time state of SimpleFeatures
pertaining to a Kafka topic.</p>
<p>The <code class="docutils literal"><span class="pre">ReplayKafkaConsumerFeatureSource</span></code> allows users to specify any
range of time in order to obtain the state of SimpleFeatures from any
previous moment.</p>
</div>
<div class="section" id="view-the-consumer-output">
<h2>View the Consumer Output<a class="headerlink" href="#view-the-consumer-output" title="Permalink to this headline">¶</a></h2>
<p>The program will construct the live and replay consumers and log
SimpleFeatures to the console after all the messages are sent to Kafka
and therefore after all the updates are made.</p>
<p>The live consumer will log the state of the two SimpleFeatures after all
updates are finished. The replay consumer will log the state of the two
SimpleFeatures five seconds earlier than the last update. The replay
consumer will create a new <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> with an additional
attribute <code class="docutils literal"><span class="pre">KafkaLogTime</span></code>. By preserving the <code class="docutils literal"><span class="pre">KafkaLogTime</span></code> as an
attribute, we can create the state of SimpleFeatures at time <em>x</em> by
querying for when <code class="docutils literal"><span class="pre">KafkaLogTime</span></code> equals <em>x</em>.</p>
<div class="highlight-bash"><div class="highlight"><pre>Consuming with the live consumer...
<span class="m">2</span> features were written to Kafka
Here are the two SimpleFeatures that were obtained with the live consumer:
fid:1 <span class="p">|</span> name:James <span class="p">|</span> age:20 <span class="p">|</span> dtg:Mon Dec <span class="m">14</span> 19:08:23 EST <span class="m">2015</span> <span class="p">|</span> geom:POINT <span class="o">(</span><span class="m">180</span> 90<span class="o">)</span>
fid:2 <span class="p">|</span> name:John <span class="p">|</span> age:62 <span class="p">|</span> dtg:Fri Oct <span class="m">02</span> 09:56:49 EDT <span class="m">2015</span> <span class="p">|</span> geom:POINT <span class="o">(</span><span class="m">180</span> -90<span class="o">)</span>

Consuming with the replay consumer...
<span class="m">2</span> features were written to Kafka
Here are the two SimpleFeatures that were obtained with the replay consumer:
fid:2 <span class="p">|</span> name:John <span class="p">|</span> age:52 <span class="p">|</span> dtg:Thu May <span class="m">21</span> 21:27:19 EDT <span class="m">2015</span> <span class="p">|</span> geom:POINT <span class="o">(</span><span class="m">132</span> -66<span class="o">)</span> <span class="p">|</span> KafkaLogTime:Tue Jun <span class="m">09</span> 13:33:47 EDT 2015
fid:1 <span class="p">|</span> name:James <span class="p">|</span> age:59 <span class="p">|</span> dtg:Sat Jan <span class="m">24</span> 06:26:44 EST <span class="m">2015</span> <span class="p">|</span> geom:POINT <span class="o">(</span><span class="m">132</span> 66<span class="o">)</span> <span class="p">|</span> KafkaLogTime:Tue Jun <span class="m">09</span> 13:33:47 EDT 2015
</pre></div>
</div>
<p>For a deeper understanding of what&#8217;s going on, we recommend exploring
the source code.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Given a stream of geospatial data, GeoMesa&#8217;s integration with Kafka
enables users to maintain a real time state of SimpleFeatures or
retrieve any arbitrary state preserved in history. One can additionally
process and analyze streams of data by integrating a data processing
system like <a class="reference external" href="https://storm.apache.org/">Storm</a> or
<a class="reference external" href="http://samza.apache.org">Samza</a>. See the <a class="reference internal" href="geomesa-quickstart-storm.html"><em>GeoMesa Storm Quick Start</em></a>
tutorial for more information on using Storm with GeoMesa.</p>
<p>For additional information about the <code class="docutils literal"><span class="pre">KafkaDataStore</span></code>, see the
<a class="reference external" href="https://github.com/locationtech/geomesa/blob/master/geomesa-kafka/geomesa-kafka-datastore/README.md">README.md</a>
on github.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, GeoMesa.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>