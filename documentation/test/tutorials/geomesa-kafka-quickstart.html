<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GeoMesa Kafka Quick Start &mdash; GeoMesa 1.2.0 Manuals</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GeoMesa 1.2.0 Manuals" href="../index.html" />
    <link rel="up" title="GeoMesa 1.2.0 Tutorials" href="index.html" />
    <link rel="next" title="Streaming Ingest" href="geomesa-osm-analysis.html" />
    <link rel="prev" title="GeoMesa Accumulo Quick Start" href="geomesa-quickstart.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="geomesa-osm-analysis.html" title="Streaming Ingest"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="geomesa-quickstart.html" title="GeoMesa Accumulo Quick Start"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">GeoMesa 1.2.0 Manuals</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">GeoMesa 1.2.0 Tutorials</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">GeoMesa Kafka Quick Start</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#run-the-code">Run the Code</a></li>
<li><a class="reference internal" href="#visualize-with-geoserver">Visualize with GeoServer</a><ul>
<li><a class="reference internal" href="#register-the-geomesa-store-with-geoserver">Register the GeoMesa store with GeoServer</a></li>
<li><a class="reference internal" href="#publish-the-layer">Publish the layer</a></li>
<li><a class="reference internal" href="#view-the-layer">View the layer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#produce-some-simplefeatures">Produce Some SimpleFeatures</a><ul>
<li><a class="reference internal" href="#what-s-happening-in-geoserver">What&#8217;s happening in GeoServer</a></li>
<li><a class="reference internal" href="#consumers-explained">Consumers explained</a></li>
</ul>
</li>
<li><a class="reference internal" href="#view-the-consumer-output">View the Consumer Output</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="geomesa-quickstart.html"
                        title="previous chapter">GeoMesa Accumulo Quick Start</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="geomesa-osm-analysis.html"
                        title="next chapter">Streaming Ingest</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorials/geomesa-kafka-quickstart.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="geomesa-kafka-quick-start">
<h1>GeoMesa Kafka Quick Start<a class="headerlink" href="#geomesa-kafka-quick-start" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will show you how to:</p>
<ol class="arabic simple">
<li>Write custom Java code to produce and consume messages in <a class="reference external" href="http://kafka.apache.org/">Apache
Kafka</a> using GeoMesa.</li>
<li>Query the data and replay the messages in a Kafka topic to achieve an
earlier state.</li>
<li>Visualize the changes being made in Kafka with GeoServer.</li>
</ol>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://kafka.apache.org/">Apache Kafka</a> is &#8220;publish-subscribe
messaging rethought as a distributed commit log.&#8221; In the context of
GeoMesa, Kafka is a useful tool for working with streams of geospatial
data. Interaction with Kafka in GeoMesa occurs with the KafkaDataStore
which implements the <a class="reference external" href="http://docs.geotools.org/latest/userguide/library/data/datastore.html">GeoTools DataStore
interface</a>.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>First, make sure that GeoServer is installed and configured to use GeoMesa as described in the <a class="reference internal" href="../user/installation_and_configuration.html"><em>Installation and Configuration</em></a> section of the GeoMesa User Manual, especially the part about the GeoMesa Kafka GeoServer plugin.</p>
<ul class="simple">
<li>basic knowledge of <a class="reference external" href="http://www.geotools.org">GeoTools</a>,
<a class="reference external" href="http://geoserver.org">GeoServer</a>, and Kafka,</li>
<li>an instance of Kafka 0.8.2.x with (an) appropriate Zookeeper
instance(s),</li>
<li>an instance of GeoServer version 2.5.2 with the GeoMesa plugin
installed,</li>
<li><a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java JDK
7</a>,</li>
<li><a class="reference external" href="http://maven.apache.org/">Apache Maven</a> 3.2.2 or better, and</li>
<li>a <a class="reference external" href="http://git-scm.com/">git</a> client.</li>
</ul>
</div>
<div class="section" id="run-the-code">
<h2>Run the Code<a class="headerlink" href="#run-the-code" title="Permalink to this headline">¶</a></h2>
<p>Ensure your Kafka and Zookeeper instances are running. You can use
<a class="reference external" href="http://kafka.apache.org/documentation.html#quickstart">Kafka&#8217;s
quickstart</a> to
get Kafka/Zookeeper instances up and running quickly.</p>
<p>The example code is found in the GeoMesa tutorials distribution, which may
be cloned from GitHub:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git clone https://github.com/geomesa/geomesa-tutorials.git
</pre></div>
</div>
<p>The Kafka QuickStart tutorial is in the <code class="docutils literal"><span class="pre">geomesa-quickstart-kafka</span></code> directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>geomesa-tutorials/geomesa-quickstart-kafka
<span class="nv">$ </span>mvn clean install -DskipTests<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>After building, run the tutorial program, where $VERSION = 1.2.0:</p>
<div class="highlight-bash"><div class="highlight"><pre>java -cp ./target/geomesa-quickstart-kafka-<span class="nv">$VERSION</span>.jar com.example.geomesa.kafka.KafkaQuickStart -brokers <span class="s2">&quot;localhost:9092&quot;</span> -zookeepers <span class="s2">&quot;localhost:2181&quot;</span>
</pre></div>
</div>
<p>where you provide your own values for the following arguments:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">brokers</span></code>: your Kafka broker instances, separated by commas.</li>
<li><code class="docutils literal"><span class="pre">zookeepers</span></code>: your Zookeeper nodes, separated by commas.</li>
<li><code class="docutils literal"><span class="pre">zkPath</span></code>: Zookeeper&#8217;s path where metadata is stored. Defaults to
/geomesa/ds/kafka.</li>
</ul>
<p>The program will create some metadata in Zookeeper and an associated
topic in your Kafka instance, and pause execution to let you add the
newly created <code class="docutils literal"><span class="pre">KafkaDataStore</span></code> to GeoServer.</p>
</div>
<div class="section" id="visualize-with-geoserver">
<h2>Visualize with GeoServer<a class="headerlink" href="#visualize-with-geoserver" title="Permalink to this headline">¶</a></h2>
<div class="section" id="register-the-geomesa-store-with-geoserver">
<h3>Register the GeoMesa store with GeoServer<a class="headerlink" href="#register-the-geomesa-store-with-geoserver" title="Permalink to this headline">¶</a></h3>
<p>Log into GeoServer using your user and password credentials. Click
“Stores” in the left-hand gutter and “Add new Store”. If you do not see
the Kafka Data Store listed under Vector Data Sources, ensure the plugin
and dependencies are in the right directory and restart GeoServer.</p>
<p>Select the <code class="docutils literal"><span class="pre">Kafka</span> <span class="pre">Data</span> <span class="pre">Store</span></code> vector data source and enter the
following parameters:</p>
<ul class="simple">
<li>basic store info<ul>
<li><code class="docutils literal"><span class="pre">workspace</span></code>: this is dependent upon your GeoServer installation</li>
<li><code class="docutils literal"><span class="pre">data</span> <span class="pre">source</span> <span class="pre">name</span></code>: pick a sensible name, such as,
<code class="docutils literal"><span class="pre">geomesa_kafka_quickstart</span></code></li>
<li><code class="docutils literal"><span class="pre">description</span></code>: this is strictly decorative;
<code class="docutils literal"><span class="pre">GeoMesa</span> <span class="pre">Kafka</span> <span class="pre">quick</span> <span class="pre">start</span></code></li>
</ul>
</li>
<li>connection parameters: these are the same parameter values that you
supplied on the command-line when you ran the tutorial; they describe
how to connect to the Kafka instance where your data resides<ul>
<li><code class="docutils literal"><span class="pre">timeout</span></code>: how long the data will be available, in milliseconds</li>
</ul>
</li>
</ul>
<p>Note: If you left out the zkPath command line argument when running the
quickstart program, you can leave the zkPath connection parameter in
GeoServer empty.</p>
<div class="figure" id="id1">
<img alt="&quot;Inputting parameters into geoserver&quot;" src="../_images/kafkadatastore1.png" />
<p class="caption"><span class="caption-text">&#8220;Inputting parameters into geoserver&#8221;</span></p>
</div>
<p>Click &#8220;Save&#8221; and GeoServer will search your Kafka instance for any
GeoMesa-managed feature types.</p>
</div>
<div class="section" id="publish-the-layer">
<h3>Publish the layer<a class="headerlink" href="#publish-the-layer" title="Permalink to this headline">¶</a></h3>
<p>GeoServer should recognize the <code class="docutils literal"><span class="pre">KafkaQuickStart</span></code> feature type that
should be presented as a layer that can be published. Click on the
&#8220;Publish&#8221; link. You will be taken to the Edit Layer screen.</p>
<p>In the Data pane, you&#8217;ll need to enter values for the bounding boxes. In
this case, you can click on the links to compute these values from the
data. Click &#8220;Save&#8221;.</p>
</div>
<div class="section" id="view-the-layer">
<h3>View the layer<a class="headerlink" href="#view-the-layer" title="Permalink to this headline">¶</a></h3>
<p>Click on the &#8220;Layer Preview&#8221; link in the left-hand gutter. If you don&#8217;t
see the quick-start layer on the first page of results, enter the name
of the layer you just created into the search box, and press &lt;Enter&gt;.</p>
<p>Once you see your layer, click on the &#8220;OpenLayers&#8221; link, which will open
a new tab. At this point, there are no messages in Kafka so nothing will
be shown.</p>
</div>
</div>
<div class="section" id="produce-some-simplefeatures">
<h2>Produce Some SimpleFeatures<a class="headerlink" href="#produce-some-simplefeatures" title="Permalink to this headline">¶</a></h2>
<p>Resume the program&#8217;s execution by inputting &lt;Enter&gt; in the terminal now
that the <code class="docutils literal"><span class="pre">KafkaDataStore</span></code> is registered in GeoServer. The program will
create two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s and additionally write a stream of
updates to the two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s over the course of about a
minute.</p>
<p>You should refresh the GeoServer page repeatedly to visualize the
updates being written to Kafka.</p>
<div class="section" id="what-s-happening-in-geoserver">
<h3>What&#8217;s happening in GeoServer<a class="headerlink" href="#what-s-happening-in-geoserver" title="Permalink to this headline">¶</a></h3>
<p>The layer preview of GeoServer uses the
<code class="docutils literal"><span class="pre">LiveKafkaConsumerFeatureSource</span></code> to show a real time view of the
current state of the data stream. Two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s are being
updated over time in Kafka which is reflected in the GeoServer display.</p>
<p>You should see two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s that start on the left side
gradually move to the right side while crossing each other in the
middle, as the page is refreshed. As the two <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s get
updated, the older <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s disappear from the display.</p>
<div class="figure" id="id2">
<img alt="&quot;GeoServer view&quot;" src="../_images/kafkadatastore2.png" />
<p class="caption"><span class="caption-text">&#8220;GeoServer view&#8221;</span></p>
</div>
</div>
<div class="section" id="consumers-explained">
<h3>Consumers explained<a class="headerlink" href="#consumers-explained" title="Permalink to this headline">¶</a></h3>
<p>GeoMesa wraps Kafka consumers in two different ways; as a
<code class="docutils literal"><span class="pre">LiveKafkaConsumerFeatureSource</span></code> or
<code class="docutils literal"><span class="pre">ReplayKafkaConsumerFeatureSource</span></code> (which implement GeoTools&#8217;
<a class="reference external" href="http://docs.geotools.org/latest/javadocs/org/geotools/data/FeatureSource.html">FeatureSource</a>
API).</p>
<p>The <code class="docutils literal"><span class="pre">LiveKafkaConsumerFeatureSource</span></code> will consume messages as they are
being produced and maintain the real time state of SimpleFeatures
pertaining to a Kafka topic.</p>
<p>The <code class="docutils literal"><span class="pre">ReplayKafkaConsumerFeatureSource</span></code> allows users to specify any
range of time in order to obtain the state of SimpleFeatures from any
previous moment.</p>
</div>
</div>
<div class="section" id="view-the-consumer-output">
<h2>View the Consumer Output<a class="headerlink" href="#view-the-consumer-output" title="Permalink to this headline">¶</a></h2>
<p>The program will construct the live and replay consumers and log
SimpleFeatures to the console after all the messages are sent to Kafka
and therefore after all the updates are made.</p>
<p>The live consumer will log the state of the two SimpleFeatures after all
updates are finished. The replay consumer will log the state of the two
SimpleFeatures five seconds earlier than the last update. The replay
consumer will create a new SimpleFeatureType with an additional
attribute <code class="docutils literal"><span class="pre">KafkaLogTime</span></code>. By preserving the <code class="docutils literal"><span class="pre">KafkaLogTime</span></code> as an
attribute, we can create the state of SimpleFeatures at time <em>x</em> by
querying for when <code class="docutils literal"><span class="pre">KafkaLogTime</span></code> equals <em>x</em>.</p>
<div class="highlight-bash"><div class="highlight"><pre>Consuming with the live consumer...
<span class="m">2</span> features were written to Kafka
Here are the two SimpleFeatures that were obtained with the live consumer:
fid:1 <span class="p">|</span> name:James <span class="p">|</span> age:20 <span class="p">|</span> dtg:Mon Dec <span class="m">14</span> 19:08:23 EST <span class="m">2015</span> <span class="p">|</span> geom:POINT <span class="o">(</span><span class="m">180</span> 90<span class="o">)</span>
fid:2 <span class="p">|</span> name:John <span class="p">|</span> age:62 <span class="p">|</span> dtg:Fri Oct <span class="m">02</span> 09:56:49 EDT <span class="m">2015</span> <span class="p">|</span> geom:POINT <span class="o">(</span><span class="m">180</span> -90<span class="o">)</span>

Consuming with the replay consumer...
<span class="m">2</span> features were written to Kafka
Here are the two SimpleFeatures that were obtained with the replay consumer:
fid:2 <span class="p">|</span> name:John <span class="p">|</span> age:52 <span class="p">|</span> dtg:Thu May <span class="m">21</span> 21:27:19 EDT <span class="m">2015</span> <span class="p">|</span> geom:POINT <span class="o">(</span><span class="m">132</span> -66<span class="o">)</span> <span class="p">|</span> KafkaLogTime:Tue Jun <span class="m">09</span> 13:33:47 EDT 2015
fid:1 <span class="p">|</span> name:James <span class="p">|</span> age:59 <span class="p">|</span> dtg:Sat Jan <span class="m">24</span> 06:26:44 EST <span class="m">2015</span> <span class="p">|</span> geom:POINT <span class="o">(</span><span class="m">132</span> 66<span class="o">)</span> <span class="p">|</span> KafkaLogTime:Tue Jun <span class="m">09</span> 13:33:47 EDT 2015
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Since the source code for this quickstart is accessible, it is advised
to follow along in the code to get a deeper understanding of what&#8217;s
really going on.</p>
<p>Given a stream of geospatial data, GeoMesa&#8217;s integration with Kafka
enables users to maintain a real time state of SimpleFeatures or
retrieve any arbitrary state preserved in history. One can additionally
process and analyze streams of data by integrating a data processing
system like <a class="reference external" href="https://storm.apache.org/">Storm</a> or
<a class="reference external" href="http://samza.apache.org">Samza</a>. We have a
<a class="reference external" href="http://www.geomesa.org/geomesa-osm-analysis/">tutorial</a> on using
Storm with GeoMesa.</p>
<p>For additional information about the <code class="docutils literal"><span class="pre">KafkaDataStore</span></code>, see the
<a class="reference external" href="https://github.com/locationtech/geomesa/blob/master/geomesa-kafka/geomesa-kafka-datastore/README.md">readme</a>
on github.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="geomesa-osm-analysis.html" title="Streaming Ingest"
             >next</a> |</li>
        <li class="right" >
          <a href="geomesa-quickstart.html" title="GeoMesa Accumulo Quick Start"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">GeoMesa 1.2.0 Manuals</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >GeoMesa 1.2.0 Tutorials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, GeoMesa.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
  </body>
</html>