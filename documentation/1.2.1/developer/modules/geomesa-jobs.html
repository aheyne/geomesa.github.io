

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>geomesa-jobs &mdash; GeoMesa 1.2.1 Manuals</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme_custom.css" type="text/css" />
  

  

  
    <link rel="top" title="GeoMesa 1.2.1 Manuals" href="../../index.html"/>
        <link rel="up" title="Modules" href="../modules.html"/>
        <link rel="next" title="geomesa-metrics" href="geomesa-metrics.html"/>
        <link rel="prev" title="geomesa-convert" href="geomesa-convert.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoMesa
          

          
          </a>

          
            
            
              <div class="version">
                1.2.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">GeoMesa 1.2.1 User Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">GeoMesa 1.2.1 Developer Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">GeoMesa Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html">The GeoMesa API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis.html">Analysis</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../modules.html">Modules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="geomesa-compute.html">geomesa-compute</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-convert.html">geomesa-convert</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">geomesa-jobs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#building-instructions">Building Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geomesa-input-and-output-formats">GeoMesa Input and Output Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#map-reduce-jobs">Map/Reduce Jobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-metrics.html">geomesa-metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-process.html">geomesa-process</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-raster.html">geomesa-raster</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-stream.html">geomesa-stream</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-utils.html">geomesa-utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="geomesa-web-data.html">geomesa-web-data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">GeoMesa 1.2.1 Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">GeoMesa</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">GeoMesa 1.2.1 Developer Manual</a> &raquo;</li>
      
          <li><a href="../modules.html">Modules</a> &raquo;</li>
      
    <li>geomesa-jobs</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/developer/modules/geomesa-jobs.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="geomesa-jobs">
<span id="id1"></span><h1>geomesa-jobs<a class="headerlink" href="#geomesa-jobs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="building-instructions">
<h2>Building Instructions<a class="headerlink" href="#building-instructions" title="Permalink to this headline">¶</a></h2>
<p>This project contains map/reduce and scalding jobs for maintaining
GeoMesa.</p>
<p>If you wish to build this project separately, you can with maven:</p>
<div class="code shell highlight-python"><div class="highlight"><pre>geomesa&gt; mvn clean install -pl geomesa-jobs
</pre></div>
</div>
</div>
<div class="section" id="geomesa-input-and-output-formats">
<h2>GeoMesa Input and Output Formats<a class="headerlink" href="#geomesa-input-and-output-formats" title="Permalink to this headline">¶</a></h2>
<p>GeoMesa provides input and output formats that can be used in Hadoop
map/reduce jobs. The input/output formats can be used directly in Scala,
or there are Java interfaces under the <code class="docutils literal"><span class="pre">interop</span></code> package.</p>
<p>The input/output formats have two versions each, for compatibility with
the &#8216;old&#8217; Hadoop api (under the <code class="docutils literal"><span class="pre">mapred</span></code> package) and the &#8216;new&#8217; Hadoop
api (under the <code class="docutils literal"><span class="pre">mapreduce</span></code> package).</p>
<p>There are sample jobs provided that can be used as templates for more
complex operations. These are:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">org</span><span class="o">.</span><span class="n">locationtech</span><span class="o">.</span><span class="n">geomesa</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">interop</span><span class="o">.</span><span class="n">mapred</span><span class="o">.</span><span class="n">FeatureCountJob</span>
<span class="n">org</span><span class="o">.</span><span class="n">locationtech</span><span class="o">.</span><span class="n">geomesa</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">interop</span><span class="o">.</span><span class="n">mapred</span><span class="o">.</span><span class="n">FeatureWriterJob</span>
<span class="n">org</span><span class="o">.</span><span class="n">locationtech</span><span class="o">.</span><span class="n">geomesa</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">interop</span><span class="o">.</span><span class="n">mapreduce</span><span class="o">.</span><span class="n">FeatureCountJob</span>
<span class="n">org</span><span class="o">.</span><span class="n">locationtech</span><span class="o">.</span><span class="n">geomesa</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">interop</span><span class="o">.</span><span class="n">mapreduce</span><span class="o">.</span><span class="n">FeatureWriterJob</span>
</pre></div>
</div>
<div class="section" id="geomesainputformat">
<h3>GeoMesaInputFormat<a class="headerlink" href="#geomesainputformat" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">GeoMesaInputFormat</span></code> can be used to get <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s into
your jobs directly from GeoMesa.</p>
<p>Use the static <code class="docutils literal"><span class="pre">configure</span></code> method to set up your job. You need to
provide it with a map of connection parameters, which will be used to
retrieve the GeoTools DataStore. You also need to provide a feature type
name. Optionally, you can provide a CQL filter, which will be used to
select a subset of features in your store.</p>
<p>The key provided to your mapper with be a <code class="docutils literal"><span class="pre">Text</span></code> with the
<code class="docutils literal"><span class="pre">SimpleFeature</span></code> ID. The value will be the <code class="docutils literal"><span class="pre">SimpleFeature</span></code>.</p>
</div>
<div class="section" id="geomesaoutputformat">
<h3>GeoMesaOutputFormat<a class="headerlink" href="#geomesaoutputformat" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">GeoMesaOutputFormat</span></code> can be used to write <code class="docutils literal"><span class="pre">SimpleFeature</span></code>s
back into GeoMesa.</p>
<p>Use the static <code class="docutils literal"><span class="pre">configure</span></code> method to set up your job. You need to
provide it with a map of connection parameters, which will be used to
retrieve the GeoTools <code class="docutils literal"><span class="pre">DataStore</span></code>. Optionally, you can also configure
the BatchWriter configuration used to write data to Accumulo.</p>
<p>The key you output does not matter, and will be ignored. The value
should be a <code class="docutils literal"><span class="pre">SimpleFeature</span></code> that you wish to write. If the
<code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> associated with the <code class="docutils literal"><span class="pre">SimpleFeature</span></code> does not yet
exist in GeoMesa, it will be created for you. You may write different
<code class="docutils literal"><span class="pre">SimpleFeatureType</span></code>s, but note that they will all share a common
catalog table.</p>
</div>
</div>
<div class="section" id="map-reduce-jobs">
<h2>Map/Reduce Jobs<a class="headerlink" href="#map-reduce-jobs" title="Permalink to this headline">¶</a></h2>
<p>To facilitate running jobs, you may wish to build a shaded jar that
contains all the required dependencies. Ensure that the pom references
the correct versions of hadoop, accumulo etc for your cluster, then
build the project using the &#8216;assemble&#8217; profile</p>
<div class="code shell highlight-python"><div class="highlight"><pre>geomesa&gt; mvn clean install -P assemble -pl geomesa-jobs
</pre></div>
</div>
<p>The following instructions assume you have built a shaded jar; if not
you will need to use the &#8216;libjars&#8217; argument to ensure the correct jars
are available on the distributed classpath.</p>
<div class="section" id="attribute-indexing">
<span id="attribute-indexing-job"></span><h3>Attribute Indexing<a class="headerlink" href="#attribute-indexing" title="Permalink to this headline">¶</a></h3>
<p>GeoMesa provides indexing on attributes to improve certain queries. You
can indicate attributes that should be indexed when you create your
schema (simple feature type). If you decide later on that you would like
to index additional attributes, you can use the attribute indexing job.
You only need to run this job once.</p>
<p>The job can be invoked through yarn as follows (jar version may vary
slightly):</p>
<div class="code shell highlight-python"><div class="highlight"><pre>geomesa&gt; yarn jar geomesa-jobs/target/geomesa-jobs-1.0.0-shaded.jar \
    org.locationtech.geomesa.jobs.index.AttributeIndexJob \
    --geomesa.input.instanceId &lt;instance&gt; \
    --geomesa.input.zookeepers &lt;zookeepers&gt; \
    --geomesa.input.user &lt;user&gt; \
    --geomesa.input.password &lt;pwd&gt; \
    --geomesa.input.tableName &lt;catalog-table&gt; \
    --geomesa.input.feature &lt;feature&gt; \
    --geomesa.index.coverage &lt;full|join&gt; \ # optional attribute
    --geomesa.index.attributes &lt;attributes to index - space separated&gt;
</pre></div>
</div>
<p>(Note that if you did not build with the &#8216;assemble&#8217; profile, you will
also need to include an extensive -libjars argument with all dependent
jars)</p>
</div>
<div class="section" id="updating-existing-data-to-the-latest-index-format">
<h3>Updating Existing Data to the Latest Index Format<a class="headerlink" href="#updating-existing-data-to-the-latest-index-format" title="Permalink to this headline">¶</a></h3>
<p>GeoMesa is constantly improving our indexing. We strive to maintain
backwards comaptiblity, but old data can&#8217;t always take advantage of the
improvements we make. However, old data can be updated through the
SchemaCopyJob. This will copy it to a new table (or feature name),
rewriting all the data using the latest codebase. Once the data is
updated, you can drop the old tables and rename the new tables back to
the original names.</p>
<p>The job can be invoked through yarn as follows (jar version may vary
slightly):</p>
<div class="code shell highlight-python"><div class="highlight"><pre>yarn jar geomesa-jobs/target/geomesa-jobs-1.0.0-shaded.jar \
    org.locationtech.geomesa.jobs.index.SchemaCopyJob \
    --geomesa.input.instanceId &lt;instance&gt; \
    --geomesa.output.instanceId &lt;instance&gt; \
    --geomesa.input.zookeepers &lt;zookeepers&gt; \
    --geomesa.output.zookeepers &lt;zookeepers&gt; \
    --geomesa.input.user &lt;user&gt; \
    --geomesa.output.user &lt;user&gt; \
    --geomesa.input.password &lt;pwd&gt; \
    --geomesa.output.password &lt;pwd&gt; \
    --geomesa.input.tableName &lt;catalog-table&gt; \
    --geomesa.output.tableName &lt;new-catalog-table&gt; \
    --geomesa.input.feature &lt;feature&gt; \
    --geomesa.output.feature &lt;feature&gt; \
    --geomesa.input.cql &lt;options cql filter for input features&gt;
</pre></div>
</div>
<p>(Note that if you did not build with the &#8216;assemble&#8217; profile, you will
also need to include an extensive -libjars argument with all dependent
jars)</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="geomesa-metrics.html" class="btn btn-neutral float-right" title="geomesa-metrics" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="geomesa-convert.html" class="btn btn-neutral" title="geomesa-convert" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2016 Commonwealth Computer Research, Inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.2.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>