<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Feature Level Visibility &amp; Security &mdash; GeoMesa 1.2.0 Manuals</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="GeoMesa 1.2.0 Manuals" href="../index.html" />
    <link rel="up" title="GeoMesa 1.2.0 Tutorials" href="index.html" />
    <link rel="next" title="Geohash Ranges" href="geohash-substrings.html" />
    <link rel="prev" title="GeoMesa Authorizations" href="geomesa-examples-authorizations.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoMesa</a>
        <span class="navbar-text navbar-version pull-left"><b>1.2.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">GeoMesa 1.2.0 User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">GeoMesa 1.2.0 Developer Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">GeoMesa 1.2.0 Tutorials</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Feature Level Visibility &amp; Security</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#download-and-build-the-tutorial">Download and Build the Tutorial</a></li>
<li><a class="reference internal" href="#run-the-tutorial">Run the Tutorial</a></li>
<li><a class="reference internal" href="#understanding-the-code">Understanding The Code</a></li>
<li><a class="reference internal" href="#adding-new-accumulo-users">Adding New Accumulo Users</a></li>
<li><a class="reference internal" href="#geoserver-visualization">GeoServer Visualization</a></li>
<li><a class="reference internal" href="#expanding-the-concept">Expanding The Concept</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="geomesa-examples-authorizations.html" title="Previous Chapter: GeoMesa Authorizations"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; GeoMesa Autho...</span>
    </a>
  </li>
  <li>
    <a href="geohash-substrings.html" title="Next Chapter: Geohash Ranges"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Geohash Ranges &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/tutorials/geomesa-feature-level-visibility.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="feature-level-visibility-security">
<h1>Feature Level Visibility &amp; Security<a class="headerlink" href="#feature-level-visibility-security" title="Permalink to this headline">¶</a></h1>
<p>GeoMesa supports security on a per-feature level, leveraging Accumulo&#8217;s support
for built-in cell-level visibility. This allows data to be filtered on a granular
level for different users. From the Accumulo user guide:</p>
<blockquote>
<div>Accumulo extends the BigTable data model to implement a security
mechanism known as cell-level security. Every key-value pair has its
own security label, stored under the column visibility element of
the key, which is used to determine whether a given user meets the
security requirements to read the value. This enables data of
various security levels to be stored within the same row, and users
of varying degrees of access to query the same table, while
preserving data confidentiality.</div></blockquote>
<p>In this tutorial, we&#8217;ll go through ingesting data with varying
levels of visibility and querying that data as different users through GeoServer.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>You will need:</p>
<ul class="simple">
<li>an Accumulo 1.5 or 1.6 instance</li>
<li>an Accumulo user that has appropriate permissions to manage authorizations and query data</li>
<li>Java JDK 7</li>
<li><a class="reference external" href="http://maven.apache.org/">Apache Maven</a> 3.2.2 or better</li>
<li>a <a class="reference external" href="http://git-scm.com/">git</a> client</li>
</ul>
<p>If you haven&#8217;t already read both the <a class="reference internal" href="../user/installation_and_configuration.html"><em>Installation and Configuration</em></a> section of
the GeoMesa User Manual and the  <a class="reference internal" href="geomesa-quickstart-accumulo.html"><em>GeoMesa Accumulo Quick Start</em></a>, you should do so now,
and make sure you have gone through the initial setup of GeoMesa.</p>
<p>Additionally, you should be familiar with <a class="reference external" href="https://accumulo.apache.org/1.5/accumulo_user_manual.html#_security_label_expressions">Accumulo&#8217;s Security Label Expression
Syntax</a>,
which we make use of when securing features in GeoMesa.</p>
</div>
<div class="section" id="download-and-build-the-tutorial">
<h2>Download and Build the Tutorial<a class="headerlink" href="#download-and-build-the-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Pick a reasonable directory on your machine, and run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git clone git@github.com:geomesa/geomesa-tutorials.git
<span class="nv">$ </span><span class="nb">cd </span>geomesa-tutorials
</pre></div>
</div>
<p>To build, run</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mvn clean install -pl geomesa-examples-featurelevelvis
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Note: ensure that the version of Accumulo, Hadoop, etc in the root <code class="docutils literal"><span class="pre">pom.xml</span></code> match your environment.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Note: depending on the version, you may also need to build GeoMesa locally.
Instructions can be found <a class="reference external" href="https://github.com/locationtech/geomesa/">here</a>.</p>
</div>
</div>
<div class="section" id="run-the-tutorial">
<h2>Run the Tutorial<a class="headerlink" href="#run-the-tutorial" title="Permalink to this headline">¶</a></h2>
<p>On the command-line, run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>java -cp geomesa-examples-featurelevelvis/target/geomesa-examples-featurelevelvis-<span class="si">${</span><span class="nv">geomesa</span><span class="p">.version</span><span class="si">}</span>.jar com.example.geomesa.accumulo.FeatureLevelVisibility -instanceId &lt;instance&gt; -zookeepers &lt;zookeepers&gt; -user &lt;user&gt; -password &lt;password&gt; -tableName &lt;table&gt;
</pre></div>
</div>
<p>where you provide the following arguments:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;instance&gt;</span></code> the name of your Accumulo instance</li>
<li><code class="docutils literal"><span class="pre">&lt;zookeepers&gt;</span></code> your Zookeeper nodes, separated by commas</li>
<li><code class="docutils literal"><span class="pre">&lt;user&gt;</span></code> the name of an Accumulo user that has permissions to
create, read and write tables</li>
<li><code class="docutils literal"><span class="pre">&lt;password&gt;</span></code> the password for the previously-mentioned Accumulo
user</li>
<li><code class="docutils literal"><span class="pre">&lt;table&gt;</span></code> the name of the destination table that will accept these
test records; this table should either not exist or should be empty</li>
</ul>
<p>You should see output on creating and querying the simple features.</p>
</div>
<div class="section" id="understanding-the-code">
<h2>Understanding The Code<a class="headerlink" href="#understanding-the-code" title="Permalink to this headline">¶</a></h2>
<p>If you inspect the code, you&#8217;ll notice only a few changes from the
original Accumulo Quick Start project. The main change is that the
<code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> has an additional attribute, &#8220;visibility&#8221;, added
to it. This attribute will assist later in testing that features were
written with the appropriate Accumulo visibilities.</p>
<p>Additionally, if you look in the <code class="docutils literal"><span class="pre">createNewFeatures</span></code> method, you&#8217;ll
see:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">simpleFeature</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;Visibility&quot;</span><span class="o">,</span> <span class="s">&quot;admin&quot;</span><span class="o">);</span>
    <span class="n">SecurityUtils</span><span class="o">.</span><span class="na">setFeatureVisibility</span><span class="o">(</span><span class="n">simpleFeature</span><span class="o">,</span> <span class="s">&quot;admin&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">simpleFeature</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;Visibility&quot;</span><span class="o">,</span> <span class="s">&quot;user|admin&quot;</span><span class="o">);</span>
    <span class="n">SecurityUtils</span><span class="o">.</span><span class="na">setFeatureVisibility</span><span class="o">(</span><span class="n">simpleFeature</span><span class="o">,</span> <span class="s">&quot;user|admin&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This is where visibilities are being set in Accumulo. The line</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">SecurityUtils</span><span class="o">.</span><span class="na">setFeatureVisibility</span><span class="o">(</span><span class="n">simpleFeature</span><span class="o">,</span> <span class="s">&quot;admin&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>is adding storing the visibility in the <code class="docutils literal"><span class="pre">SimpleFeature</span></code>&#8216;s user data.
When writing to Accumulo, GeoMesa will use that user data to apply
the appropriate Accumulo visibility string to the record.</p>
<p>Because the feature has a visibility of <code class="docutils literal"><span class="pre">admin</span></code>, only users
with the <code class="docutils literal"><span class="pre">admin</span></code> authorization will be able to see the feature.</p>
<p>In the Quickstart example, 500 features are written with the visibility
<code class="docutils literal"><span class="pre">admin</span></code> and 500 are written with <code class="docutils literal"><span class="pre">user|admin</span></code>. However, unless users
are explicitly granted permissions to read these tables and read
features with that level of authorization, we cannot visualize the data
in a meaningful way. Next we will add new Accumulo users to do just that.</p>
</div>
<div class="section" id="adding-new-accumulo-users">
<h2>Adding New Accumulo Users<a class="headerlink" href="#adding-new-accumulo-users" title="Permalink to this headline">¶</a></h2>
<p>In this part of the tutorial, we&#8217;ll get familiar with the Accumulo
shell. First, login to Accumulo with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>accumulo shell -u &lt;username&gt;
</pre></div>
</div>
<p>Accumulo will prompt you for your password. You should then see something similar to this:</p>
<div class="highlight-bash"><div class="highlight"><pre>Shell - Apache Accumulo Interactive Shell
-
- version: 1.5.0
- instance name: accumulo
- instance id: <span class="o">{</span>instance-id<span class="o">}</span>
-
- <span class="nb">type</span> <span class="s1">&#39;help&#39;</span> <span class="k">for</span> a list of available commands
-
<span class="o">{</span>username-here<span class="o">}</span>@accumulo&gt;
</pre></div>
</div>
<p>Now, we&#8217;re ready to add new users to Accumulo with the Accumulo shell
<code class="docutils literal"><span class="pre">createuser</span></code> command. At the prompt, run:</p>
<div class="highlight-bash"><div class="highlight"><pre>&gt; createuser user
Enter new password <span class="k">for</span> <span class="s1">&#39;user&#39;</span>: ***********
Please confirm new password <span class="k">for</span> <span class="s1">&#39;user&#39;</span>: ***********
&gt; createuser admin
Enter new password <span class="k">for</span> <span class="s1">&#39;admin&#39;</span>: ***********
Please confirm new password <span class="k">for</span> <span class="s1">&#39;admin&#39;</span>: ***********
</pre></div>
</div>
<p>With these new users added, we&#8217;re going to give them the proper
authorizations with the <code class="docutils literal"><span class="pre">setauths</span></code> command:</p>
<div class="highlight-bash"><div class="highlight"><pre>&gt; setauths -s admin,user -u admin
&gt; setauths -s user -u user
</pre></div>
</div>
<p>This will grant authorizations <code class="docutils literal"><span class="pre">admin,user</span></code> to <code class="docutils literal"><span class="pre">admin</span></code>, meaning as
the user <code class="docutils literal"><span class="pre">admin</span></code>, one will be able to read both features written with
the visibility <code class="docutils literal"><span class="pre">user</span></code> and features written with the visibility
<code class="docutils literal"><span class="pre">admin</span></code>. Additionally, the user <code class="docutils literal"><span class="pre">user</span></code> will be granted <code class="docutils literal"><span class="pre">user</span></code>
authorizations, meaning they can only view features of visibility
<code class="docutils literal"><span class="pre">user</span></code>. They will never see features written with the visibility
<code class="docutils literal"><span class="pre">admin</span></code>.</p>
<p>Let&#8217;s move on to GeoServer to visualize feature level visibility.</p>
</div>
<div class="section" id="geoserver-visualization">
<h2>GeoServer Visualization<a class="headerlink" href="#geoserver-visualization" title="Permalink to this headline">¶</a></h2>
<p>Assuming you have already set up GeoServer  as described in the <a class="reference internal" href="../user/installation_and_configuration.html"><em>Installation and Configuration</em></a>
section of the GeoMesa User Manual, we&#8217;re going to add a new <code class="docutils literal"><span class="pre">DataStore</span></code> to GeoServer.
First, login to GeoServer, and then click &#8220;Add stores&#8221; from the homepage.</p>
<p>Next, click the link to add a new &#8220;Accumulo (GeoMesa)&#8221; store and name
it <code class="docutils literal"><span class="pre">feature-level-visibility-admin</span></code>. Fill in the correct
connection parameters to make contact with GeoMesa/Accumulo, but be sure
to use <code class="docutils literal"><span class="pre">admin</span></code> for the &#8220;user&#8221; parameter.</p>
<div class="figure" id="id1">
<img alt="&quot;GeoMesa DataStore configuration with &quot;admin&quot; user&quot;" src="../_images/gs-admin-datastore.png" />
<p class="caption"><span class="caption-text">&#8220;GeoMesa DataStore configuration with &#8220;admin&#8221; user&#8221;</span></p>
</div>
<p>Then, publish your layer when prompted by GeoServer. Remember to click
the &#8220;Compute from data&#8221; and &#8220;Compute from native bounds&#8221; links on the
&#8220;Add Layer&#8221; page, and click &#8220;Save&#8221;.</p>
<p>Repeat the above steps one more time to add an additional <code class="docutils literal"><span class="pre">DataStore</span></code>
with the same parameters, but this time, name it <code class="docutils literal"><span class="pre">feature-level-visibility-user</span></code>
and use <code class="docutils literal"><span class="pre">user</span></code> for the &#8220;user&#8221; parameter.</p>
<p>With your layers added in GeoServer, we&#8217;re nearly ready to visualize the
data. One final step is adding our custom SLD that will style your
features to make visualizations of the data even easier to understand.</p>
<p>Download <a class="reference download internal" href="../_downloads/feature-level-vis.sld"><code class="xref download docutils literal"><span class="pre">feature-level-vis.sld</span></code></a>,
or copy the contents, and add it as a Style in GeoServer. It will style the points on
a map based on the visibility attribute present.</p>
<p>Lastly, click on &#8220;Layer Preview&#8221; in the left hand sidebar and find your
two newly added layers. If everything went correctly, you should see
fewer results returning in the <code class="docutils literal"><span class="pre">user</span></code> layer than in the <code class="docutils literal"><span class="pre">admin</span></code>
layer, and this is expected behavior. Because <code class="docutils literal"><span class="pre">user</span></code> has only been
granted permission to view features with the <code class="docutils literal"><span class="pre">user</span></code> visibility, only
those 500 records are returned. However, the <code class="docutils literal"><span class="pre">admin</span></code> user is granted
permission to see both <code class="docutils literal"><span class="pre">admin</span></code> and <code class="docutils literal"><span class="pre">user</span></code> visibilities.</p>
</div>
<div class="section" id="expanding-the-concept">
<h2>Expanding The Concept<a class="headerlink" href="#expanding-the-concept" title="Permalink to this headline">¶</a></h2>
<p>In this very simple example, you wrote features of two different
visibilities, added two new users to Accumulo, and granted them separate
authorization levels to be able to view portions of the data. This
tutorial has real-world use cases in security and data integrity. For
example, when storing sensitive data and having users of varying
authorization and security levels querying that data, visibility labels
ensure that sensitive data is not leaked to a user of a lower level of
security.</p>
<p>The concept of feature level visibility can be extended and modified to
have many more, or only a few, visibility levels. And with GeoServer
being flexible and extensible, writing a module to consider feature
level security in GeoServer is relatively painless.</p>
<p>GeoMesa also provides a mechanism to have authorizations applied on a
per-user level, instead of a per-datastore level. More information,
including integration with PKI and LDAP, can be found in the Authorizations
tutorial under <a class="reference internal" href="geomesa-examples-authorizations.html#authorizations-gs-pki-ldap"><span>Applying Authorizations and Visibilities to GeoServer Using PKIS and LDAP</span></a>.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, you learned about feature level visibility and
security built into GeoMesa. You ingested a dataset of 1000 features to
your GeoMesa instance &#8211; 500 having the visibility <code class="docutils literal"><span class="pre">admin</span></code> and 500
having the visibility <code class="docutils literal"><span class="pre">user|admin</span></code>. You added two new users to
Accumulo and granted them the correct authorization levels to query the
data. Finally, you visualized the data and saw how, despite both
<code class="docutils literal"><span class="pre">DataStore</span></code> connecting to the same features in GeoMesa, <code class="docutils literal"><span class="pre">user</span></code> could
only have a subset of those features returned because of the lower
security authorization.</p>
<p>If you found this tutorial helpful, have additional questions, or run
into an error at any step of the way, feel free to <a class="reference external" href="mailto:geomesa-users&#37;&#52;&#48;locationtech&#46;org">reach out on our
listserv</a>.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, GeoMesa.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>