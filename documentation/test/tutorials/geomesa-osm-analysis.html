<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Streaming Ingest &mdash; GeoMesa 1.2.0 Manuals</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GeoMesa 1.2.0 Manuals" href="../index.html" />
    <link rel="up" title="GeoMesa 1.2.0 Tutorials" href="index.html" />
    <link rel="next" title="Map-Reduce Ingest" href="geomesa-gdelt-analysis.html" />
    <link rel="prev" title="GeoMesa Kafka Quick Start" href="geomesa-kafka-quickstart.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="geomesa-gdelt-analysis.html" title="Map-Reduce Ingest"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="geomesa-kafka-quickstart.html" title="GeoMesa Kafka Quick Start"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">GeoMesa 1.2.0 Manuals</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">GeoMesa 1.2.0 Tutorials</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Streaming Ingest</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#ingest">Ingest</a><ul>
<li><a class="reference internal" href="#obtaining-osm-data">Obtaining OSM data</a></li>
<li><a class="reference internal" href="#building-the-example-code">Building the example code</a></li>
<li><a class="reference internal" href="#datastore-initialization">DataStore initialization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-up-the-ingest-topology">Setting Up the Ingest Topology</a></li>
<li><a class="reference internal" href="#setting-up-the-kafka-topic">Setting Up the Kafka Topic</a></li>
<li><a class="reference internal" href="#storm-spouts-and-bolts">Storm Spouts and Bolts</a></li>
<li><a class="reference internal" href="#analyze">Analyze</a><ul>
<li><a class="reference internal" href="#geoserver-setup">GeoServer Setup</a></li>
<li><a class="reference internal" href="#register-the-geomesa-datastore-with-geoserver">Register the GeoMesa DataStore with GeoServer</a></li>
<li><a class="reference internal" href="#publish-layer">PUBLISH LAYER</a></li>
<li><a class="reference internal" href="#query">QUERY</a></li>
<li><a class="reference internal" href="#heatmaps">HEATMAPS</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="geomesa-kafka-quickstart.html"
                        title="previous chapter">GeoMesa Kafka Quick Start</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="geomesa-gdelt-analysis.html"
                        title="next chapter">Map-Reduce Ingest</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorials/geomesa-osm-analysis.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="streaming-ingest">
<h1>Streaming Ingest<a class="headerlink" href="#streaming-ingest" title="Permalink to this headline">¶</a></h1>
<p>This tutorial shows you how to:</p>
<ol class="arabic simple">
<li>Quickly and easily ingest big OSM (Open Street Map) data files into a
GeoMesa Accumulo table via a Kafka/Storm stream.</li>
<li>Leverage GeoServer to query and visualize the data.</li>
</ol>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You will need access to a Kafka 0.8 installation, a Storm 0.8 installation as well as an Accumulo 1.5 or 1.6 database.</p>
</div>
<p>You should have access to:</p>
<ul class="simple">
<li>an instance of Accumulo 1.5 or 1.6 running on Hadoop
2.2,</li>
<li>an Accumulo user with create-table and write permissions,</li>
<li>an installation of Kafka 0.8,</li>
<li>an installation of Storm 0.8, and</li>
<li>an instance of GeoServer 2.5.2 with the GeoMesa plugin installed</li>
</ul>
<p>Several tools should also be installed and configured:</p>
<ul class="simple">
<li>The <a class="reference external" href="http://tukanni.org/xz/">xz</a> data compression tool,</li>
<li>Java JDK 7,</li>
<li><a class="reference external" href="http://maven.apache.org">Apache Maven</a> 3.2.2 or better, and</li>
<li>a <a class="reference external" href="http://git-scm.com/">git</a> client.</li>
</ul>
</div>
<div class="section" id="ingest">
<h2>Ingest<a class="headerlink" href="#ingest" title="Permalink to this headline">¶</a></h2>
<div class="section" id="obtaining-osm-data">
<h3>Obtaining OSM data<a class="headerlink" href="#obtaining-osm-data" title="Permalink to this headline">¶</a></h3>
<p>Download the <a class="reference external" href="http://planet.openstreetmap.org/">Open Street Map</a>
(OSM) data file <cite>simple-gps-points-120312.txt</cite> from <a class="reference external" href="http://planet.openstreetmap.org/gps/">http://planet.openstreetmap.org/gps/</a>.
This might take a while; the file is approximately 7 GB.</p>
<p>Use the following command to unpack the data, adjusting the filename here and in subsequent commands if you downloaded a more recent version:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>xz simple-gps-points-120312.txt.xz
</pre></div>
</div>
<p>Note: In this demonstration, we will use the <code class="docutils literal"><span class="pre">simple-gps-points</span></code> OSM
data that contains only the location of an observation.</p>
</div>
<div class="section" id="building-the-example-code">
<h3>Building the example code<a class="headerlink" href="#building-the-example-code" title="Permalink to this headline">¶</a></h3>
<p>Clone the <code class="docutils literal"><span class="pre">geomesa</span></code> and <code class="docutils literal"><span class="pre">geomesa-tutorials</span></code> projects:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git clone https://github.com/locationtech/geomesa.git
<span class="nv">$ </span>git clone https://github.com/geomesa/geomesa-tutorials.git
</pre></div>
</div>
<p>Build GeoMesa, if you haven&#8217;t already:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>geomesa
<span class="nv">$ </span>mvn clean install
</pre></div>
</div>
<p>The source code for this tutorial is in the <code class="docutils literal"><span class="pre">geomesa-quickstart-storm</span></code>
directory of <code class="docutils literal"><span class="pre">geomesa-tutorials</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> ../geomesa-tutorials/geomesa-quickstart-storm
<span class="nv">$ </span>mvn clean install
</pre></div>
</div>
</div>
<div class="section" id="datastore-initialization">
<h3>DataStore initialization<a class="headerlink" href="#datastore-initialization" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://geotools.org/">GeoTools</a> uses a <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> to
represent the schema for a feature source. We can easily create a schema
for the OSM feature type using the DataUtilities class. The schema
string is a comma separated list of attributes in the form
<code class="docutils literal"><span class="pre">&lt;ATTRIBUTE_NAME&gt;:&lt;ATTRIBUTE_CLASSNAME&gt;:&lt;ATTRIBUTE_HINT&gt;</span></code>, where the
hint is optional (for example,
&#8220;geom:Point:srid=4326,name:String,year:Integer&#8221;). In the tutorial code
in <code class="docutils literal"><span class="pre">geomesa-osm</span></code>, our <code class="docutils literal"><span class="pre">SimpleFeatureType</span></code> only needs to represent
the geometry, a single <code class="docutils literal"><span class="pre">Point</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">SimpleFeatureType</span> <span class="n">featureType</span> <span class="o">=</span> <span class="n">DataUtilities</span><span class="o">.</span><span class="na">createType</span><span class="o">(</span><span class="n">featureName</span><span class="o">,</span> <span class="s">&quot;geom:Point:srid=4326&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>We create the new feature type in GeoMesa as follows.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ds</span><span class="o">.</span><span class="na">createSchema</span><span class="o">(</span><span class="n">featureType</span><span class="o">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="setting-up-the-ingest-topology">
<h2>Setting Up the Ingest Topology<a class="headerlink" href="#setting-up-the-ingest-topology" title="Permalink to this headline">¶</a></h2>
<p>Use <code class="docutils literal"><span class="pre">storm</span> <span class="pre">jar</span></code> to submit the topology built
(<code class="docutils literal"><span class="pre">geomesa-osm/target/geomesa-quickstart-storm-$VERSION.jar</span></code>) to your Storm
Nimbus.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>storm jar geomesa-quickstart-storm-<span class="nv">$VERSION</span>.jar <span class="se">\</span>
   com.example.geomesa.storm.OSMIngest                         <span class="se">\</span>
   -instanceId &lt;accumulo-instance-id&gt;            <span class="se">\</span>
   -zookeepers &lt;zookeeper-hosts-string&gt;          <span class="se">\</span>
   -user &lt;username&gt; -password &lt;password&gt;         <span class="se">\</span>
   -auths &lt;comma-separated-authorization-string&gt; <span class="se">\</span>
   -tableName OSM -featureName event             <span class="se">\</span>
   -topic OSM                                    <span class="se">\</span>
</pre></div>
</div>
<p>Note that authorizations are optional. Unless you know that your table
already exists with explicit authorizations, or that it will be created
with default authorizations, you probably want to omit this parameter.</p>
</div>
<div class="section" id="setting-up-the-kafka-topic">
<h2>Setting Up the Kafka Topic<a class="headerlink" href="#setting-up-the-kafka-topic" title="Permalink to this headline">¶</a></h2>
<p>Now we are going to create a Kafka topic. Kafka serves as the entry
point into our Storm topology. We create a topic with several partitions
to parallelize the ingest both from the producer side as well as from
the consumer side.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>kafka-create-topic.sh       <span class="se">\</span>
   --zookeeper &lt;zookeepers&gt; <span class="se">\</span>
   --replica <span class="m">3</span>              <span class="se">\</span>
   --partition <span class="m">10</span>           <span class="se">\</span>
   --topic OSM              <span class="se">\</span>
</pre></div>
</div>
<p>Create a Kafka producer to convert the ingest file into kafka messages.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>java -cp geomesa-quickstart-storm-<span class="nv">$VERSION</span>.jar     <span class="se">\</span>
   com.example.geomesa.storm.OSMIngestProducer   <span class="se">\</span>
   -ingestFile simple-gps-points-120312.txt      <span class="se">\</span>
   -topic OSM                      <span class="se">\</span>
   -brokers &lt;kafka broker list&gt;    <span class="se">\</span>
</pre></div>
</div>
<p>Note that Kafka&#8217;s default partitioner class assigns a message partition
based on a hash of the provided key. If no key is provided, all messages
are assigned the same partition.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">x</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span> <span class="n">x</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="k">new</span> <span class="n">KeyedMessage</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="n">topic</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">rnd</span><span class="o">.</span><span class="na">nextInt</span><span class="o">()),</span> <span class="n">x</span><span class="o">));</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="storm-spouts-and-bolts">
<h2>Storm Spouts and Bolts<a class="headerlink" href="#storm-spouts-and-bolts" title="Permalink to this headline">¶</a></h2>
<p>In our example, the Storm <code class="docutils literal"><span class="pre">Spout</span></code>s will consume messages from a
Kafka topic and send them through the ingest topology.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">nextTuple</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">kafkaIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">messages</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;();</span>
        <span class="n">messages</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">kafkaIterator</span><span class="o">.</span><span class="na">next</span><span class="o">().</span><span class="na">message</span><span class="o">());</span>
        <span class="n">_collector</span><span class="o">.</span><span class="na">emit</span><span class="o">(</span><span class="n">messages</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>In our example, the <code class="docutils literal"><span class="pre">Bolt</span></code>s parse the message, create and write
<code class="docutils literal"><span class="pre">Feature</span></code>s. In the <code class="docutils literal"><span class="pre">prepare</span></code> method of the <code class="docutils literal"><span class="pre">Bolt</span></code> class, we grab
the connection params that were initialized in the constructor and get a
handle on a <code class="docutils literal"><span class="pre">FeatureWriter</span></code>.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">ds</span> <span class="o">=</span> <span class="n">DataStoreFinder</span><span class="o">.</span><span class="na">getDataStore</span><span class="o">(</span><span class="n">connectionParams</span><span class="o">);</span>
<span class="n">SimpleFeatureType</span> <span class="n">featureType</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="na">getSchema</span><span class="o">(</span><span class="n">featureName</span><span class="o">);</span>
<span class="n">featureBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleFeatureBuilder</span><span class="o">(</span><span class="n">featureType</span><span class="o">);</span>
<span class="n">featureWriter</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="na">getFeatureWriter</span><span class="o">(</span><span class="n">featureName</span><span class="o">,</span> <span class="n">Transaction</span><span class="o">.</span><span class="na">AUTO_COMMIT</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>The input to the <code class="docutils literal"><span class="pre">Bolt</span></code>&#8216;s execute method is a <code class="docutils literal"><span class="pre">Tuple</span></code> containing a
<code class="docutils literal"><span class="pre">String</span></code>. We split the <code class="docutils literal"><span class="pre">String</span></code> on &#8216;%&#8217; to get individual points. For
each point, we split on commas to extract the attributes. We parse the
latitude and longitude field to set the default geometry of our
<code class="docutils literal"><span class="pre">SimpleFeature</span></code>. Note that OSM latitude and longitude values are
stored as integers that must be divided by 107.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">private</span> <span class="n">Geometry</span> <span class="nf">getGeometry</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">attributes</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Double</span> <span class="n">lat</span> <span class="o">=</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">attributes</span><span class="o">[</span><span class="n">LATITUDE_COL_IDX</span><span class="o">])</span> <span class="o">/</span> <span class="mi">1</span><span class="n">e7</span><span class="o">;</span>
    <span class="kd">final</span> <span class="n">Double</span> <span class="n">lon</span> <span class="o">=</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">attributes</span><span class="o">[</span><span class="n">LONGITUDE_COL_IDX</span><span class="o">])</span> <span class="o">/</span> <span class="mi">1</span><span class="n">e7</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">geometryFactory</span><span class="o">.</span><span class="na">createPoint</span><span class="o">(</span><span class="k">new</span> <span class="n">Coordinate</span><span class="o">(</span><span class="n">lon</span><span class="o">,</span> <span class="n">lat</span><span class="o">));</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Tuple</span> <span class="n">tuple</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">featureBuilder</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">SimpleFeature</span> <span class="n">simpleFeature</span> <span class="o">=</span>
        <span class="n">featureBuilder</span><span class="o">.</span><span class="na">buildFeature</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">getMostSignificantBits</span><span class="o">()));</span>
    <span class="n">SimpleFeature</span><span class="o">.</span><span class="na">setDefaultGeometry</span><span class="o">(</span><span class="n">getGeometry</span><span class="o">(</span><span class="n">attributes</span><span class="o">));</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">SimpleFeature</span> <span class="n">next</span> <span class="o">=</span> <span class="n">featureWriter</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">simpleFeature</span><span class="o">.</span><span class="na">getAttributeCount</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">next</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">simpleFeature</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="o">((</span><span class="n">FeatureIdImpl</span><span class="o">)</span><span class="n">next</span><span class="o">.</span><span class="na">getIdentifier</span><span class="o">()).</span><span class="na">setID</span><span class="o">(</span><span class="n">simpleFeature</span><span class="o">.</span><span class="na">getID</span><span class="o">());</span>
        <span class="n">featureWriter</span><span class="o">.</span><span class="na">write</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="analyze">
<h2>Analyze<a class="headerlink" href="#analyze" title="Permalink to this headline">¶</a></h2>
<div class="section" id="geoserver-setup">
<h3>GeoServer Setup<a class="headerlink" href="#geoserver-setup" title="Permalink to this headline">¶</a></h3>
<p>Follow the instructions in the <a class="reference external" href="/geomesa-deployment/">GeoMesa Deployment
Tutorial</a> to install the GeoMesa plugin for
GeoServer.</p>
</div>
<div class="section" id="register-the-geomesa-datastore-with-geoserver">
<h3>Register the GeoMesa DataStore with GeoServer<a class="headerlink" href="#register-the-geomesa-datastore-with-geoserver" title="Permalink to this headline">¶</a></h3>
<p>Click &#8220;Stores&#8221; and &#8220;Add new Store&#8221;. If you do not see the Accumulo
Feature Data Store listed under Vector Data Sources, ensure the plugin
is in the right directory and restart GeoServer.</p>
<div class="figure" id="id1">
<img alt="&quot;Registering new Data Store&quot;" src="../_images/Accumulo_Feature_Data_Store.png" />
<p class="caption"><span class="caption-text">&#8220;Registering new Data Store&#8221;</span></p>
</div>
<p>Register the newly created Accumulo table using the same parameters
specified in the command line above. (If you use a workspace:layer name
other than geomesa:gdelt, you will need to change the WMS requests that
follow.)</p>
<div class="figure" id="id2">
<img alt="&quot;Registering new Accumulo Feature Data Store&quot;" src="../_images/GeoserverAccumuloStoreRegistration.png" />
<p class="caption"><span class="caption-text">&#8220;Registering new Accumulo Feature Data Store&#8221;</span></p>
</div>
</div>
<div class="section" id="publish-layer">
<h3>PUBLISH LAYER<a class="headerlink" href="#publish-layer" title="Permalink to this headline">¶</a></h3>
<p>After registering the DataStore, click to publish the layer. You will be
taken to the Edit Layer screen. In the Data pane, enter values for the
bounding boxes. For the whole world, use [-180,-90,180,90].</p>
</div>
<div class="section" id="query">
<h3>QUERY<a class="headerlink" href="#query" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s look at events in Chicago. The default point style is a red square
that does not suit our purposes. Add the SLD file
<a class="reference download internal" href="../_downloads/OSMPoint.sld"><code class="xref download docutils literal"><span class="pre">OSMPoint.sld</span></code></a>
to GeoServer.</p>
<div class="highlight-bash"><div class="highlight"><pre>http://localhost:8080/geoserver/wms?service<span class="o">=</span>WMS<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span>1.1.0<span class="p">&amp;</span><span class="nv">request</span><span class="o">=</span>GetMap<span class="p">&amp;</span><span class="nv">layers</span><span class="o">=</span>geomesa:OSM<span class="p">&amp;</span><span class="nv">styles</span><span class="o">=</span>OSMPoint<span class="p">&amp;</span><span class="nv">bbox</span><span class="o">=</span>-87.63,41.88,-87.61,41.9<span class="p">&amp;</span><span class="nv">width</span><span class="o">=</span>1400<span class="p">&amp;</span><span class="nv">height</span><span class="o">=</span>600<span class="p">&amp;</span><span class="nv">srs</span><span class="o">=</span>EPSG:4326<span class="p">&amp;</span><span class="nv">format</span><span class="o">=</span>application/openlayers
</pre></div>
</div>
<div class="figure" id="id3">
<img alt="&quot;Showing all OSM events in Chicago before Mar 12, 2012&quot;" src="../_images/ChicagoPoint.png" />
<p class="caption"><span class="caption-text">&#8220;Showing all OSM events in Chicago before Mar 12, 2012&#8221;</span></p>
</div>
</div>
<div class="section" id="heatmaps">
<h3>HEATMAPS<a class="headerlink" href="#heatmaps" title="Permalink to this headline">¶</a></h3>
<p>Use a heatmap to more clearly visualize multiple events in the same
location or high volume of data in general. Add the SLD file
<a class="reference download internal" href="../_downloads/heatmap.sld"><code class="xref download docutils literal"><span class="pre">heatmap.sld</span></code></a>
to GeoServer.</p>
<div class="highlight-bash"><div class="highlight"><pre>http://localhost:8080/geoserver/wms?service<span class="o">=</span>WMS<span class="p">&amp;</span><span class="nv">version</span><span class="o">=</span>1.1.0<span class="p">&amp;</span><span class="nv">request</span><span class="o">=</span>GetMap<span class="p">&amp;</span><span class="nv">layers</span><span class="o">=</span>geomesa:OSM<span class="p">&amp;</span><span class="nv">styles</span><span class="o">=</span>heatmap<span class="p">&amp;</span><span class="nv">bbox</span><span class="o">=</span>-87.63,41.88,-87.61,41.9<span class="p">&amp;</span><span class="nv">width</span><span class="o">=</span>1400<span class="p">&amp;</span><span class="nv">height</span><span class="o">=</span>600<span class="p">&amp;</span><span class="nv">srs</span><span class="o">=</span>EPSG:4326<span class="p">&amp;</span><span class="nv">format</span><span class="o">=</span>application/openlayers
</pre></div>
</div>
<div class="figure" id="id4">
<img alt="&quot;Showing heatmap of OSM events in Chicago before Mar 12, 2012&quot;" src="../_images/ChicagoDensity.png" />
<p class="caption"><span class="caption-text">&#8220;Showing heatmap of OSM events in Chicago before Mar 12, 2012&#8221;</span></p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="geomesa-gdelt-analysis.html" title="Map-Reduce Ingest"
             >next</a> |</li>
        <li class="right" >
          <a href="geomesa-kafka-quickstart.html" title="GeoMesa Kafka Quick Start"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">GeoMesa 1.2.0 Manuals</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >GeoMesa 1.2.0 Tutorials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, GeoMesa.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
  </body>
</html>